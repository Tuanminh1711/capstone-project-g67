<app-top-navigator></app-top-navigator>

<div class="plant-info-layout">
  <div class="plant-info-inner">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-title">Danh mục</div>
      <nav class="sidebar-menu">
        @for (item of [1,2,3,4,5,6]; track $index) {
          <a class="sidebar-item" href="#">
            <img src="" class="sidebar-icon" alt="ABCD" />
            ABCD
          </a>
        }
      </nav>
    </aside>

    <!-- Main content -->
    <section class="plant-search-section">
      <div class="plant-search-card">

        <!-- Search box -->
        <form class="plant-search-box" (ngSubmit)="onSearch()">
          <input
            type="text"
            class="plant-search-input"
            placeholder="Tìm kiếm cây..."
            [(ngModel)]="searchText"
            name="searchText"
            (ngModelChange)="onSearchInputChange()"
          />
          <button class="plant-search-btn" type="submit">
            <span class="material-icons">search</span>
            Tìm kiếm
          </button>
        </form>

        <!-- Loading -->
        @if (loading) {
          <div class="status-msg">Đang tải dữ liệu...</div>
        }

        <!-- Error -->
        @if (!loading && error) {
          <div class="status-msg error">
            {{ error }}
          </div>
        }

        <!-- Nội dung chính -->
        @if (!loading && !error) {
          @if (plants$ | async; as plants) {
            
            <!-- Không có cây -->
            @if (plants.length === 0) {
              <div class="status-msg empty">
                Không có cây nào phù hợp.
              </div>
            }

            <!-- Danh sách cây -->
            @if (plants.length > 0) {
              <div class="plant-list">
                @for (plant of plants; track plant.id) {
                  <div class="plant-card">
                    @if (plant.imageUrls.length) {
                      <img
                        [src]="plant.imageUrls[0]"
                        [alt]="plant.commonName"
                        class="plant-img"
                        (click)="viewPlantDetail(plant.id)"
                      />
                    }
                    <div class="plant-info" (click)="viewPlantDetail(plant.id)">
                      <div class="plant-title">
                        {{ plant.commonName }}
                        <span class="plant-scientific">
                          ({{ plant.scientificName }})
                          @if (plant.status === 'INACTIVE') {
                            <span class="plant-warning-icon" title="Cây này đang được xác thực thông tin bởi hệ thống">
                              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                                <circle cx="10" cy="10" r="10" fill="#ffe066"/>
                                <path d="M10 5v5.5" stroke="#bfa100" stroke-width="1.6" stroke-linecap="round"/>
                                <circle cx="10" cy="14.2" r="1.1" fill="#bfa100"/>
                              </svg>
                            </span>
                          }
                        </span>
                      </div>
                      <div class="plant-category">
                        Phân loại: {{ plant.categoryName }}
                      </div>
                      <div class="plant-desc">{{ plant.description }}</div>
                      <div class="plant-meta">
                        <span>Ánh sáng: {{ translateLightRequirement(plant.lightRequirement) }}</span> |
                        <span>Nước: {{ translateWaterRequirement(plant.waterRequirement) }}</span> |
                        <span>Độ khó: {{ translateCareDifficulty(plant.careDifficulty) }}</span>
                      </div>
                      <div class="plant-actions">
                        <button class="detail-btn" (click)="viewPlantDetail(plant.id); $event.stopPropagation()">
                          Xem chi tiết
                        </button>
                      </div>
                    </div>
                  </div>
                }
              </div>
            }

            <!-- Pagination -->
            @if (totalPages > 1) {
              <div class="pagination">
                <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 0">
                  &laquo;
                </button>
                @for (page of [].constructor(totalPages); track $index; let i = $index) {
                  <button
                    (click)="goToPage(i)"
                    [class.active]="i === currentPage"
                  >
                    {{ i + 1 }}
                  </button>
                }
                <button
                  (click)="goToPage(currentPage + 1)"
                  [disabled]="currentPage === totalPages - 1"
                >
                  &raquo;
                </button>
              </div>
            }

          }
        }
      </div>
    </section>
  </div>
</div>
