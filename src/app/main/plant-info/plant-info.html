<app-top-navigator></app-top-navigator>

<div class="plant-info-layout">
  <div class="plant-info-inner">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-title">Danh m·ª•c</div>
      <nav class="sidebar-menu">
        @if (loadingCategories) {
          <div class="sidebar-loading">ƒêang t·∫£i danh m·ª•c...</div>
        }
        @if (errorCategories) {
          <div class="sidebar-error">{{ errorCategories }}</div>
        }
        @if (!loadingCategories) {
          <!-- All category -->
          <a class="sidebar-item" href="#" [class.active]="!selectedCategoryId" (click)="handleAllCategoryClick(); $event.preventDefault()">
            <span class="sidebar-icon">üå≥</span> T·∫•t c·∫£
          </a>
          @if (categories$ | async; as categories) {
            @if (categories.length > 0) {
              @for (cat of categories; track cat.id) {
                <a class="sidebar-item" href="#" [class.active]="selectedCategoryId === cat.id" (click)="handleCategoryClick(cat.id); $event.preventDefault()">
                  <span class="sidebar-icon">üå±</span>
                  {{ translateCategoryName(cat.name) }}
                </a>
              }
            }
          }
        }

        <!-- Filter by Light Requirement -->
        <div class="sidebar-title">√Ånh s√°ng</div>
        <a href="#" class="sidebar-item" [class.active]="!selectedLightRequirement" (click)="handleLightFilter(null); $event.preventDefault()">
          <span class="sidebar-icon">üí°</span> T·∫•t c·∫£
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedLightRequirement === 'LOW'" (click)="handleLightFilter('LOW'); $event.preventDefault()">
          <span class="sidebar-icon">üü¢</span> √çt √°nh s√°ng
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedLightRequirement === 'MEDIUM'" (click)="handleLightFilter('MEDIUM'); $event.preventDefault()">
          <span class="sidebar-icon">üü°</span> √Ånh s√°ng v·ª´a ph·∫£i
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedLightRequirement === 'HIGH'" (click)="handleLightFilter('HIGH'); $event.preventDefault()">
          <span class="sidebar-icon">üî¥</span> Nhi·ªÅu √°nh s√°ng
        </a>
        <!-- Filter by Water Requirement -->
        <div class="sidebar-title">N∆∞·ªõc</div>
        <a href="#" class="sidebar-item" [class.active]="!selectedWaterRequirement" (click)="handleWaterFilter(null); $event.preventDefault()">
          <span class="sidebar-icon">üíß</span> T·∫•t c·∫£
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedWaterRequirement === 'LOW'" (click)="handleWaterFilter('LOW'); $event.preventDefault()">
          <span class="sidebar-icon">üü¢</span> √çt n∆∞·ªõc
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedWaterRequirement === 'MEDIUM'" (click)="handleWaterFilter('MEDIUM'); $event.preventDefault()">
          <span class="sidebar-icon">üü°</span> N∆∞·ªõc v·ª´a ph·∫£i
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedWaterRequirement === 'HIGH'" (click)="handleWaterFilter('HIGH'); $event.preventDefault()">
          <span class="sidebar-icon">üî¥</span> Nhi·ªÅu n∆∞·ªõc
        </a>
        <!-- Filter by Care Difficulty -->
        <div class="sidebar-title">ƒê·ªô kh√≥</div>
        <a href="#" class="sidebar-item" [class.active]="!selectedCareDifficulty" (click)="handleDifficultyFilter(null); $event.preventDefault()">
          <span class="sidebar-icon">üéØ</span> T·∫•t c·∫£
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedCareDifficulty === 'EASY'" (click)="handleDifficultyFilter('EASY'); $event.preventDefault()">
          <span class="sidebar-icon">üü¢</span> D·ªÖ chƒÉm s√≥c
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedCareDifficulty === 'MODERATE'" (click)="handleDifficultyFilter('MODERATE'); $event.preventDefault()">
          <span class="sidebar-icon">üü°</span> Trung b√¨nh
        </a>
        <a href="#" class="sidebar-item" [class.active]="selectedCareDifficulty === 'DIFFICULT'" (click)="handleDifficultyFilter('DIFFICULT'); $event.preventDefault()">
          <span class="sidebar-icon">üî¥</span> Kh√≥ chƒÉm s√≥c
        </a>
    
      </nav>
    </aside>

    <!-- Main content -->
    <section class="plant-search-section">
      <div class="plant-search-card">

        <!-- Search box -->
        <form class="plant-search-box full-width" (ngSubmit)="onSearch()">
          <input
            type="text"
            class="plant-search-input"
            placeholder="T√¨m ki·∫øm c√¢y..."
            [(ngModel)]="searchText"
            name="searchText"
            (ngModelChange)="onSearchInputChange()"
          />
          <button class="plant-search-btn" type="submit">
            <span class="material-icons">search</span>
          </button>
        </form>

        <!-- Loading -->
        @if (loading) {
          <div class="status-msg">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        }

        <!-- Error -->
        @if (!loading && error) {
          <div class="status-msg error">
            {{ error }}
          </div>
        }


        <!-- N·ªôi dung ch√≠nh -->
        @if (!loading && !error) {
          @if (plants$ | async; as plants) {
            
            <!-- Kh√¥ng c√≥ c√¢y -->
            @if (plants.length === 0) {
              <div class="status-msg empty">
                Kh√¥ng c√≥ c√¢y n√†o ph√π h·ª£p.
              </div>
            }

            <!-- Danh s√°ch c√¢y -->
            @if (plants.length > 0) {
              <div class="plant-list">
                @for (plant of plants; track trackByPlantId($index, plant)) {
                  <div class="plant-card">
                    @if (plant.imageUrls && plant.imageUrls.length > 0) {
                      <img
                        [src]="plant.imageUrls[0]"
                        [alt]="plant.commonName"
                        class="plant-img"
                        (click)="viewPlantDetail(plant.id)"
                      />
                    } @else {
                      <div class="no-image-placeholder" (click)="viewPlantDetail(plant.id)">
                        <i class="fas fa-seedling"></i>
                        <span>Ch∆∞a c√≥ ·∫£nh</span>
                      </div>
                    }
                    <div class="plant-info" (click)="viewPlantDetail(plant.id)">
                      <div class="plant-title">
                        {{ plant.commonName }}
                        <span class="plant-scientific">
                          ({{ plant.scientificName }})
                          @if (plant.reportCount && plant.reportCount > 0) {
                            <span class="plant-warning-icon tooltip-container">
                              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                                <circle cx="10" cy="10" r="10" [attr.fill]="getWarningColor(plant.reportCount)"/>
                                <path d="M10 5v5.5" stroke="#bfa100" stroke-width="1.6" stroke-linecap="round"/>
                                <circle cx="10" cy="14.2" r="1.1" fill="#bfa100"/>
                              </svg>
                              <span class="plant-warning-tooltip">C√¢y n√†y ƒë√£ b·ªã b√°o c√°o {{ plant.reportCount }} l·∫ßn</span>
                            </span>
                          }
                        </span>
                      </div>
                      <div class="plant-category">
                        Ph√¢n lo·∫°i: {{ plant.categoryName }}
                      </div>
                      <div class="plant-desc">{{ plant.description }}</div>
                      <div class="plant-meta-simple">
                        <span class="meta-item">
                          <span class="meta-label">√Ånh s√°ng:</span>
                          <span class="meta-value">{{ translateLightRequirement(plant.lightRequirement) }}</span>
                        </span>
                        <span class="meta-item">
                          <span class="meta-label">N∆∞·ªõc:</span>
                          <span class="meta-value">{{ translateWaterRequirement(plant.waterRequirement) }}</span>
                        </span>
                        <span class="meta-item">
                          <span class="meta-label">ƒê·ªô kh√≥:</span>
                          <span class="meta-value">{{ translateCareDifficulty(plant.careDifficulty) }}</span>
                        </span>
                      </div>
                      <div class="plant-actions">
                        <button class="detail-btn" (click)="viewPlantDetail(plant.id); $event.stopPropagation()">
                          Xem chi ti·∫øt
                        </button>
                      </div>
                    </div>
                  </div>
                }
              </div>
            }

            <!-- Pagination -->
            @if (totalPages > 1) {
              <div class="pagination">
                <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 0">
                  &laquo;
                </button>
                @for (page of [].constructor(totalPages); track $index; let i = $index) {
                  <button
                    (click)="goToPage(i)"
                    [class.active]="i === currentPage"
                  >
                    {{ i + 1 }}
                  </button>
                }
                <button
                  (click)="goToPage(currentPage + 1)"
                  [disabled]="currentPage === totalPages - 1"
                >
                  &raquo;
                </button>
              </div>
            }

          }
        }
      </div>
    </section>
  </div>
</div>
