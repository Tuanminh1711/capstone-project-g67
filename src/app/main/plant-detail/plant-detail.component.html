<app-top-navigator></app-top-navigator>
<div class="plant-detail-container">
  <div class="plant-detail-content">
    <!-- Authentication required message -->
    <div *ngIf="requiresAuth" class="auth-required-msg">
      <div class="auth-card">
        <h3>YÃªu cáº§u Ä‘Äƒng nháº­p</h3>
        <p>Äá»ƒ xem thÃ´ng tin chi tiáº¿t cá»§a cÃ¢y nÃ y, báº¡n cáº§n Ä‘Äƒng nháº­p vÃ o há»‡ thá»‘ng.</p>
        <div class="auth-actions">
          <button class="login-btn" (click)="goToLogin()">ÄÄƒng nháº­p</button>
          <button class="back-to-list-btn" (click)="goBack()">Quay láº¡i danh sÃ¡ch</button>
        </div>
      </div>
    </div>
    <!-- Error -->
    <div *ngIf="!requiresAuth && error" class="status-msg error">
      {{ error }}
      <button class="retry-btn" (click)="reloadPlantDetail()">Thá»­ láº¡i</button>
    </div>
    <!-- Error state -->
    <div *ngIf="!loading && error" class="status-msg error">
      {{ error }}
      <button class="retry-btn" (click)="reloadPlantDetail()">Thá»­ láº¡i</button>
    </div>
    <!-- Plant detail content -->
    <ng-container *ngIf="!loading && !error && plant">
      <ng-container *ngIf="isLimitedInfo; else fullDetail">
        <div class="limited-info-notice">
          <div class="notice-content">
            <span>â„¹ï¸ Äang hiá»ƒn thá»‹ thÃ´ng tin cÆ¡ báº£n. <a (click)="openLoginDialog(); $event.stopPropagation(); $event.preventDefault()" class="login-link">ÄÄƒng nháº­p</a> Ä‘á»ƒ xem thÃ´ng tin chi tiáº¿t Ä‘áº§y Ä‘á»§.</span>
          </div>
        </div>
      </ng-container>
      <ng-template #fullDetail>
        <div class="plant-detail-cards modern">
          <!-- Card trÃ¡i: áº¢nh, tÃªn, tráº¡ng thÃ¡i, mÃ´ táº£, meta -->
          <div class="plant-detail-card modern left-card">
            <div class="plant-info-image modern">
              <div class="main-image">
                <div class="image-wrapper modern">
                  <img [src]="selectedImage || plant.imageUrls[0] || '/assets/image/logo.png'" [alt]="plant.commonName" class="plant-img modern" />
                </div>
              </div>
            </div>
            <div class="plant-info-main modern">
              <h1 class="plant-name modern">
                {{ plant.commonName }}
                <span *ngIf="plant.status === 'INACTIVE'" class="plant-warning-icon" title="CÃ¢y nÃ y Ä‘ang Ä‘Æ°á»£c xÃ¡c thá»±c thÃ´ng tin bá»Ÿi há»‡ thá»‘ng">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                    <circle cx="10" cy="10" r="10" fill="#ffe066"/>
                    <path d="M10 5v5.5" stroke="#bfa100" stroke-width="1.6" stroke-linecap="round"/>
                    <circle cx="10" cy="14.2" r="1.1" fill="#bfa100"/>
                  </svg>
                </span>
              </h1>
              <p class="plant-scientific modern">({{ plant.scientificName }})</p>
              <div class="plant-tags modern">
                <span class="plant-category modern">
                  <span class="category-icon">ğŸ·ï¸</span>
                  {{ plant.categoryName }}
                </span>
                
              </div>
              <div class="action-buttons modern">
                <button class="add-to-collection-btn modern" (click)="addToCollection()" title="ThÃªm cÃ¢y nÃ y vÃ o bá»™ sÆ°u táº­p cá»§a báº¡n">
                  <span class="btn-icon">ğŸŒ±</span>
                  <span class="btn-text">ThÃªm vÃ o bá»™ sÆ°u táº­p</span>
                </button>
                <button class="report-btn modern" (click)="onReportPlant()" title="BÃ¡o cÃ¡o thÃ´ng tin sai" [disabled]="plant.status === 'INACTIVE'">
                  <span class="btn-icon">ğŸš©</span>
                  <span class="btn-text">BÃ¡o cÃ¡o</span>
                </button>
              </div>
            </div>
            <div class="section-header modern" *ngIf="!isGuest">
              <h3><span class="section-icon">ğŸ“</span> MÃ´ táº£ chi tiáº¿t</h3>
            </div>
            <div class="description-content modern scroll-card" *ngIf="!isGuest">
              <div class="scroll-inner">
                <p>{{ plant.description || 'ChÆ°a cÃ³ mÃ´ táº£ chi tiáº¿t cho loáº¡i cÃ¢y nÃ y.' }}</p>
              </div>
            </div>
            <div class="plant-meta modern" *ngIf="plant.createdAt">
              <div class="meta-item">
                <span class="meta-icon">ğŸ“…</span>
                <span class="meta-label">NgÃ y táº¡o:</span>
                <span class="meta-value">{{ formatDate(plant.createdAt) }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">ğŸ”„</span>
                <span class="meta-label">Cáº­p nháº­t gáº§n nháº¥t:</span>
                <span class="meta-value">{{ formatDate(plant.createdAt) }}</span>
              </div>
            </div>
          </div>
          <!-- Card pháº£i: YÃªu cáº§u chÄƒm sÃ³c, hÆ°á»›ng dáº«n, bá»‡nh -->
          <div class="plant-detail-card modern right-card">
            <div class="section-header modern">
              <h3><span class="section-icon">ğŸŒ¿</span>HÆ°á»›ng dáº«n chÄƒm sÃ³c</h3>
            </div>
            <div class="care-requirements modern">
              <div class="care-grid modern">
                @for (item of [
                  {
                    icon: 'â˜€ï¸',
                    label: 'Ãnh sÃ¡ng',
                    value: plantUiHelper.translateLightRequirement(plant.lightRequirement),
                    tips: 'Vá»‹ trÃ­: ' + plantUiHelper.getLightPosition(plant.lightRequirement),
                    class: 'light-care',
                    indicatorClass: 'light-indicator',
                    show: true
                  },
                  {
                    icon: 'ğŸ’§',
                    label: 'NÆ°á»›c',
                    value: plantUiHelper.translateWaterRequirement(plant.waterRequirement),
                    tips: 'Táº§n suáº¥t: ' + plantUiHelper.getWaterFrequency(plant.waterRequirement),
                    class: 'water-care',
                    indicatorClass: 'water-indicator',
                    show: true
                  },
                  {
                    icon: 'ğŸŒ±',
                    label: 'Äá»™ khÃ³',
                    value: plantUiHelper.translateCareDifficulty(plant.careDifficulty),
                    tips: plantUiHelper.getDifficultyTip(plant.careDifficulty),
                    class: 'difficulty-care',
                    indicatorClass: plantUiHelper.getDifficultyClass(plant.careDifficulty),
                    show: true
                  },
                  {
                    icon: 'ğŸ ',
                    label: 'Vá»‹ trÃ­ phÃ¹ há»£p',
                    value: plant.suitableLocation,    
                    class: 'location-care',
                    indicatorClass: 'location-indicator',
                    show: !!plant.suitableLocation
                  }
                ]; track item.label)
                {
                  @if (item.show) {
                <div class="care-item {{item.class}} modern">
                  <div class="care-icon-wrapper modern">
                    <div class="care-icon">{{item.icon}}</div>
                    <div class="care-indicator" [class]="item.indicatorClass"></div>
                  </div>
                  <div class="care-info modern">
                    <span class="care-label">{{item.label}}</span>
                    <span class="care-value">{{item.value}}</span>
                    <div class="care-tips">{{item.tips}}</div>
                  </div>
                </div>
                  }
                }
              </div>
            </div>
            <div class="section-header modern" *ngIf="plant.careInstructions && !isGuest">
              <h3><span class="section-icon">ğŸ“‹</span> HÆ°á»›ng dáº«n chÄƒm sÃ³c chi tiáº¿t</h3>
            </div>
            <div class="instructions-content modern scroll-card" *ngIf="plant.careInstructions && !isGuest">
              <div class="scroll-inner">
                <p>{{ plant.careInstructions }}</p>
              </div>
            </div>
            <div class="section-header modern" *ngIf="plant.commonDiseases && !isGuest">
              <h3><span class="section-icon">ğŸ©º</span> Bá»‡nh thÆ°á»ng gáº·p</h3>
            </div>
            <div class="diseases-content modern" *ngIf="plant.commonDiseases && !isGuest">
              <p>{{ plant.commonDiseases }}</p>
            </div>
            <!-- Guest notice for protected content -->
            <div class="guest-notice-section" *ngIf="isGuest && (plant.description || plant.careInstructions || plant.commonDiseases)">
              <div class="auth-required-section">
                <div class="section-header modern">
                  <h3><span class="section-icon">ğŸ”’</span> Ná»™i dung cáº§n Ä‘Äƒng nháº­p</h3>
                </div>
                <div class="auth-notice-content">
                  <p>Äá»ƒ xem thÃ´ng tin chi tiáº¿t vá»:</p>
                  <ul>
                    <li *ngIf="plant.description">ğŸ“ MÃ´ táº£ chi tiáº¿t vá» cÃ¢y</li>
                    <li *ngIf="plant.careInstructions">ğŸ“‹ HÆ°á»›ng dáº«n chÄƒm sÃ³c chi tiáº¿t</li>
                    <li *ngIf="plant.commonDiseases">ğŸ©º Bá»‡nh thÆ°á»ng gáº·p vÃ  cÃ¡ch phÃ²ng trÃ¡nh</li>
                  </ul>
                  <p>Vui lÃ²ng Ä‘Äƒng nháº­p vÃ o há»‡ thá»‘ng.</p>
                  <button class="login-cta-btn" (click)="openLoginDialog()">
                    <span class="btn-icon">ğŸ”‘</span>
                    <span class="btn-text">ÄÄƒng nháº­p ngay</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>
