<app-top-navigator></app-top-navigator>

<div class="add-plant-container" style="padding-bottom: 64px;">
  <div class="add-plant-content">
    
    <!-- Header -->
    <div class="page-header">
      <button class="back-btn" (click)="goBack()">
        ← Quay lại
      </button>
      <h1>Thêm cây vào bộ sưu tập</h1>
    </div>

    <!-- Loading -->
    <div *ngIf="loading && !plant" class="loading-message">
      <p>Đang tải thông tin cây...</p>
    </div>

    <!-- Error -->
    <div *ngIf="error" class="error-message">
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadPlantInfo()">Thử lại</button>
    </div>

    <!-- Main content -->
    <div *ngIf="plant && !error" class="main-content">
      
      <!-- Plant info (left side) -->
      <div class="plant-info-section">
        <div class="plant-card">
          <div class="plant-image">
            <img 
              [src]="plant.imageUrls[0] || '/assets/image/default-plant.png'" 
              [alt]="plant.commonName"
              onerror="this.src='/assets/image/default-plant.png'"
            >
          </div>
          
          <div class="plant-details">
            <h2 class="plant-name">{{ plant.commonName || plant.scientificName }}</h2>
            <p class="scientific-name" *ngIf="plant.scientificName && plant.commonName">
              <em>{{ plant.scientificName }}</em>
            </p>
            <p class="category">{{ plant.categoryName }}</p>
            
            <div class="care-info">
              <div class="care-item">
                <span class="label">Ánh sáng:</span>
                <span class="value">{{ translateLightRequirement(plant.lightRequirement) }}</span>
              </div>
              <div class="care-item">
                <span class="label">Nước:</span>
                <span class="value">{{ translateWaterRequirement(plant.waterRequirement) }}</span>
              </div>
              <div class="care-item">
                <span class="label">Độ khó:</span>
                <span class="value">{{ translateCareDifficulty(plant.careDifficulty) }}</span>
              </div>
            </div>

            <div class="description" *ngIf="plant.description">
              <h4>Mô tả:</h4>
              <p>{{ plant.description }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Add to collection form (right side) -->
      <div class="form-section">
        <div class="form-card">
          <h3>Thông tin cây của bạn</h3>
          
          <form (ngSubmit)="onSubmit()" #plantForm="ngForm">
            
            <!-- Nickname -->
            <div class="form-group">
              <label for="nickname">Tên gọi <span class="required">*</span></label>
              <input 
                type="text" 
                id="nickname"
                name="nickname"
                [(ngModel)]="formData.nickname"
                placeholder="Ví dụ: Sen đá của tôi"
                required
                maxlength="100"
              >
              <small class="help-text">Đặt tên riêng cho cây của bạn</small>
            </div>

            <!-- Planting Date -->
            <div class="form-group">
              <label for="plantingDate">Ngày trồng <span class="required">*</span></label>
              <input 
                type="date" 
                id="plantingDate"
                name="plantingDate"
                [(ngModel)]="formData.plantingDate"
                required
                [max]="getCurrentDate()"
              >
              <small class="help-text">Ngày bạn bắt đầu trồng/chăm sóc cây này</small>
            </div>

            <!-- Location -->
            <div class="form-group">
              <label for="location">Vị trí trong nhà <span class="required">*</span></label>
              <select 
                id="location"
                name="location"
                [(ngModel)]="formData.locationInHouse"
                required
              >
                <option value="">-- Chọn vị trí --</option>
                <option *ngFor="let location of locationOptions" [value]="location">
                  {{ location }}
                </option>
              </select>
              <small class="help-text">Cây được đặt ở đâu trong nhà?</small>
            </div>

            <!-- Reminder -->
            <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  name="reminderEnabled"
                  [(ngModel)]="formData.reminderEnabled"
                >
                <span class="checkmark"></span>
                Bật nhắc nhở chăm sóc
              </label>
              <small class="help-text">Nhận thông báo nhắc nhở tưới nước và chăm sóc</small>
            </div>

            <!-- Submit buttons -->
            <div class="form-actions">
              <button 
                type="button" 
                class="cancel-btn"
                (click)="goBack()"
              >
                Hủy
              </button>
              <button 
                type="submit" 
                class="submit-btn"
                [disabled]="loading || !plantForm.form.valid"
              >
                <span *ngIf="loading">Đang thêm...</span>
                <span *ngIf="!loading">Thêm vào bộ sưu tập</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
