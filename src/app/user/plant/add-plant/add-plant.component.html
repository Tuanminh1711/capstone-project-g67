<app-top-navigator></app-top-navigator>

<div class="add-plant-container" style="padding-bottom: 64px;">
  <div class="add-plant-content">
    
    <!-- Header -->
    <div class="page-header">
      <h1>Th√™m c√¢y v√†o b·ªô s∆∞u t·∫≠p</h1>
    </div>

    <!-- Loading -->
    <div *ngIf="loading && !plant" class="loading-message">
      <p>ƒêang t·∫£i th√¥ng tin c√¢y...</p>
    </div>

    <!-- Error -->
    <div *ngIf="error" class="error-message">
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadPlantInfo()">Th·ª≠ l·∫°i</button>
    </div>

    <!-- Main content -->
    <div *ngIf="plant && !error" class="main-content" style="display: flex; gap: 32px; align-items: stretch;">
      <!-- Plant info (left side) -->
      <div class="plant-info-section" style="flex: 1; min-width: 0; height: 100%;">
        <div class="plant-card">
          <div class="plant-image">
            <img 
              [src]="plantImageUrl"
              [alt]="plant.commonName || plant.scientificName || 'Plant'"
              (error)="plantImageUrl = 'assets/image/default-plant.png'"
              class="plant-img"
            />
          </div>
          
          <div class="plant-details">
            <h2 class="plant-name">{{ plant.commonName || plant.scientificName }}</h2>
            <p class="scientific-name" *ngIf="plant.scientificName && plant.commonName">
              <em>{{ plant.scientificName }}</em>
            </p>
            <p class="category">{{ plant.categoryName }}</p>
            
            <div class="care-info">
              <div class="care-item">
                <span class="label">√Ånh s√°ng:</span>
                <span class="value">{{ translateLightRequirement(plant.lightRequirement) }}</span>
              </div>
              <div class="care-item">
                <span class="label">N∆∞·ªõc:</span>
                <span class="value">{{ translateWaterRequirement(plant.waterRequirement) }}</span>
              </div>
              <div class="care-item">
                <span class="label">ƒê·ªô kh√≥:</span>
                <span class="value">{{ translateCareDifficulty(plant.careDifficulty) }}</span>
              </div>
            </div>

            <div class="description" *ngIf="plant.description">
              <h4>M√¥ t·∫£:</h4>
              <p>{{ plant.description }}</p>
            </div>
    
          </div>
        </div>
      </div>

      <!-- Add to collection form (right side) -->
      <div class="form-section" style="flex: 1; min-width: 0; height: 100%;">
        <div class="form-card">
          <h3>Th√¥ng tin c√¢y c·ªßa b·∫°n</h3>
          
          <form (ngSubmit)="onSubmit()" #plantForm="ngForm">
            
            <!-- Nickname -->
            <div class="form-group">
              <label for="nickname">T√™n g·ªçi <span class="required">*</span></label>
              <input 
                type="text" 
                id="nickname"
                name="nickname"
                [(ngModel)]="formData.nickname"
                placeholder="V√≠ d·ª•: Sen ƒë√° c·ªßa t√¥i"
                required
                maxlength="100"
              >
              <small class="help-text">ƒê·∫∑t t√™n ri√™ng cho c√¢y c·ªßa b·∫°n</small>
            </div>

            <!-- Planting Date -->
            <div class="form-group">
              <label for="plantingDate">Ng√†y tr·ªìng <span class="required">*</span></label>
              <input 
                type="date" 
                id="plantingDate"
                name="plantingDate"
                [(ngModel)]="formData.plantingDate"
                required
                [max]="getCurrentDate()"
              >
              <small class="help-text">Ng√†y b·∫°n b·∫Øt ƒë·∫ßu tr·ªìng/chƒÉm s√≥c c√¢y n√†y</small>
            </div>

            <!-- Location -->
            <div class="form-group">
              <label for="location">V·ªã tr√≠ trong nh√† <span class="required">*</span></label>
              <select 
                id="location"
                name="location"
                [(ngModel)]="formData.locationInHouse"
                required
              >
                <option value="">-- Ch·ªçn v·ªã tr√≠ --</option>
                <option *ngFor="let location of locationOptions" [value]="location">
                  {{ location }}
                </option>
              </select>
              <small class="help-text">C√¢y ƒë∆∞·ª£c ƒë·∫∑t ·ªü ƒë√¢u trong nh√†?</small>
            </div>

            <!-- Image Upload -->
            <div class="form-group">
              <label for="images">·∫¢nh c√¢y c·ªßa b·∫°n</label>
              <input 
                type="file" 
                id="images"
                name="images"
                accept="image/*"
                multiple
                (change)="onImageSelected($event)"
                class="file-input"
              >
              <div class="file-upload-area" (click)="triggerFileInput()">
                <div class="upload-content">
                  <i class="upload-icon">üì∏</i>
                  <p class="upload-text">Nh·∫•n ƒë·ªÉ ch·ªçn ·∫£nh</p>
                  <small class="upload-hint">H·ªó tr·ª£ nhi·ªÅu ·∫£nh, ƒë·ªãnh d·∫°ng JPG, PNG</small>
                </div>
              </div>
              
              <!-- Preview selected images -->
              <div class="image-preview-container" *ngIf="selectedImages && selectedImages.length > 0">
                <h5>·∫¢nh ƒë√£ ch·ªçn ({{ selectedImages.length }}):</h5>
                <div class="image-preview-grid">
                  <div class="image-preview-item" *ngFor="let image of selectedImages; let i = index">
                    <img [src]="getImagePreview(image)" [alt]="'Preview ' + (i + 1)" class="preview-img">
                    <button type="button" class="remove-image-btn" (click)="removeImage(i)" title="X√≥a ·∫£nh">
                      ‚úï
                    </button>
                    <div class="image-info">
                      <small>{{ image.name }}</small>
                      <small>{{ formatFileSize(image.size) }}</small>
                    </div>
                  </div>
                </div>
              </div>
              <small class="help-text">Th√™m ·∫£nh th·ª±c t·∫ø c√¢y c·ªßa b·∫°n ƒë·ªÉ d·ªÖ theo d√µi</small>
            </div>

            <!-- Submit buttons -->
            <div class="form-actions">
              <button 
                type="button" 
                class="cancel-btn"
                (click)="goBack()"
              >
                H·ªßy
              </button>
              <button 
                type="button" 
                class="submit-btn"
                [disabled]="isSubmitDisabled()"
                (click)="onSubmit()"
              >
                <span *ngIf="loading">ƒêang th√™m...</span>
                <span *ngIf="!loading">Th√™m v√†o b·ªô s∆∞u t·∫≠p</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Location Warning Popup -->
<div class="popup-overlay" *ngIf="showLocationWarning" (click)="cancelLocationWarning()">
  <div class="warning-popup" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <div class="warning-icon">‚ö†Ô∏è</div>
      <h3>C·∫£nh b√°o v·ªã tr√≠ tr·ªìng</h3>
    </div>
    <div class="popup-content">
      <p>{{ locationWarningMessage }}</p>
    </div>
    <div class="popup-actions">
      <button type="button" class="cancel-btn" (click)="cancelLocationWarning()">
        Thay ƒë·ªïi v·ªã tr√≠
      </button>
      <button type="button" class="confirm-btn" (click)="confirmLocationWarning()">
        Ti·∫øp t·ª•c th√™m c√¢y
      </button>
    </div>
  </div>
</div>
