<app-top-navigator></app-top-navigator>

<div class="garden-container" (click)="onPageVisible()" style="margin-bottom: 64px; padding-bottom: 32px;">
  <!-- Hero Section -->
  <section class="garden-hero">
    <div class="hero-content">
      <div class="hero-header">
        <h1 class="hero-title">ğŸŒ¿ Khu VÆ°á»n Cá»§a TÃ´i</h1>
        <div class="hero-actions">
          @if (isLoggedIn) {
            <button 
              class="create-plant-btn primary"
              (click)="router.navigate(['/user/create-new-plant'])"
            >
              <i class="fas fa-plus"></i>
              <span>Táº¡o cÃ¢y má»›i</span>
            </button>
            <button 
              class="add-existing-btn secondary"
              (click)="router.navigate(['/plant-info'])"
            >
              <i class="fas fa-search"></i>
              <span>ThÃªm tá»« thÆ° viá»‡n</span>
            </button>
          }
        </div>
      </div>
      <p class="hero-subtitle">Quáº£n lÃ½ vÃ  chÄƒm sÃ³c bá»™ sÆ°u táº­p cÃ¢y cáº£nh cÃ¡ nhÃ¢n cá»§a báº¡n</p>
      
      <!-- Statistics - Only show when user has plants -->
      @if (!loading && !error && userPlants.length > 0) {
        <div class="garden-stats">
          <div class="stat-item">
            <div class="stat-icon">ğŸŒ±</div>
            <div class="stat-content">
              <div class="stat-number">{{ userPlants.length }}</div>
              <div class="stat-label">Tá»•ng sá»‘ cÃ¢y</div>
            </div>
          </div>
          <!-- ÄÃ£ xoÃ¡ thá»‘ng kÃª nháº¯c nhá»Ÿ -->
        </div>
      }
    </div>
  </section>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-garden">
      <div class="loading-animation">
        <div class="growing-plant">
          <div class="plant-stem"></div>
          <div class="plant-leaves">
            <div class="leaf leaf-1">ğŸŒ¿</div>
            <div class="leaf leaf-2">ğŸƒ</div>
            <div class="leaf leaf-3">ğŸŒ±</div>
          </div>
        </div>
      </div>
      <p class="loading-text">Äang táº£i khu vÆ°á»n cá»§a báº¡n...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="error-garden">
      <div class="error-icon">ğŸ¥€</div>
      <h3>{{ error.includes('Ä‘Äƒng nháº­p') ? 'Cáº§n Ä‘Äƒng nháº­p' : 'Oops! CÃ³ lá»—i xáº£y ra' }}</h3>
      <p>{{ error }}</p>
      <div class="error-actions">
        @if (error.includes('Ä‘Äƒng nháº­p')) {
          <button 
            class="auth-btn"
            (click)="handleAuthRequired()"
          >
            <span>ğŸ”‘</span> ÄÄƒng nháº­p
          </button>
        } @else {
          <button 
            class="retry-btn" 
            (click)="refreshGarden()"
            [disabled]="loading"
          >
            <span>ğŸ”„</span> {{ loading ? 'Äang thá»­ láº¡i...' : 'Thá»­ láº¡i' }}
          </button>
        }
      </div>
    </div>
  }

  <!-- Empty State -->
  @if (!loading && !error && userPlants.length === 0) {
    <div class="empty-garden">
      <div class="empty-illustration">
        <div class="empty-pot">
          <div class="pot-body"></div>
          <div class="pot-soil"></div>
          <div class="sprouting-seed">ğŸŒ±</div>
        </div>
      </div>
      <div class="empty-content">
        <h3>{{ isLoggedIn ? 'Khu vÆ°á»n cá»§a báº¡n Ä‘ang trá»‘ng' : 'ChÃ o má»«ng Ä‘áº¿n vá»›i My Garden!' }}</h3>
        <p>{{ isLoggedIn ? 'HÃ£y báº¯t Ä‘áº§u trá»“ng nhá»¯ng cÃ¢y cáº£nh yÃªu thÃ­ch Ä‘á»ƒ táº¡o nÃªn khu vÆ°á»n xanh tÆ°Æ¡i!' : 'ÄÄƒng nháº­p Ä‘á»ƒ báº¯t Ä‘áº§u táº¡o khu vÆ°á»n xanh cá»§a riÃªng báº¡n!' }}</p>
        @if (isLoggedIn) {
          <div class="empty-actions">
            <button 
              class="start-gardening-btn primary"
              (click)="router.navigate(['/user/create-new-plant'])"
            >
              <i class="fas fa-plus"></i>
              <span>Táº¡o cÃ¢y má»›i</span>
            </button>
            <button 
              class="browse-plants-btn secondary" 
              (click)="router.navigate(['/plant-info'])"
            >
              <i class="fas fa-search"></i>
              <span>Chá»n tá»« thÆ° viá»‡n</span>
            </button>
          </div>
        } @else {
          <button 
            class="start-gardening-btn primary" 
            (click)="handleAuthRequired()"
          >
            <i class="fas fa-sign-in-alt"></i>
            <span>ÄÄƒng nháº­p Ä‘á»ƒ báº¯t Ä‘áº§u</span>
          </button>
        }
      </div>
    </div>
  }

  <!-- Plants Display -->
  @if (!loading && !error && userPlants.length > 0) {
    <div class="plants-display">
      <div class="garden-layout">
        <div class="garden-ground">
          <div class="plants-garden">
            @for (plant of userPlants; track plant.userPlantId; let i = $index) {
              <div 
                class="plant-spot"
                [style.animation-delay]="i * 0.1 + 's'"
              >
                <div class="plant-container" (click)="viewPlantDetail(plant.userPlantId)">
                  <div class="plant-image-wrapper">
                    <div class="plant-image-container">
                      <img 
                        [src]="plant.imageUrl ? plant.imageUrl : '/assets/image/logo.png'" 
                        [alt]="plant.nickname"
                        class="plant-image"
                        (error)="$any($event.target).src='/assets/image/logo.png'"
                      />
                    </div>
                    <div class="plant-glow"></div>
                  </div>
                  
                  <div class="plant-info">
                    <h3 class="plant-name">{{ plant.nickname || 'CÃ¢y khÃ´ng tÃªn' }}</h3>
                    
                    <div class="plant-details">
                      <div class="detail-row">
                        <span class="detail-icon">
                          <i class="fas fa-map-marker-alt"></i>
                        </span>
                        <span class="detail-text">{{ plant.plantLocation || 'ChÆ°a xÃ¡c Ä‘á»‹nh' }}</span>
                      </div>
                      <!-- Nháº¯c nhá»Ÿ chÄƒm sÃ³c: chuyá»ƒn lÃªn gÃ³c trÃªn bÃªn pháº£i -->
                      <div class="reminder-floating-btns">
                        <button type="button" class="reminder-icon-btn" [class.active]="reminderEnabledMap[plant.userPlantId] === true" (click)="toggleAllReminders(plant); $event.stopPropagation()" title="{{ reminderEnabledMap[plant.userPlantId] === true ? 'Táº¯t táº¥t cáº£ nháº¯c nhá»Ÿ' : 'Báº­t táº¥t cáº£ nháº¯c nhá»Ÿ' }}">
                          <i class="fas" [ngClass]="reminderEnabledMap[plant.userPlantId] === true ? 'fa-bell' : 'fa-bell-slash'"></i>
                        </button>
                        <button type="button" class="reminder-icon-btn outline" (click)="openReminderTypeDialog(plant); $event.stopPropagation()" title="Tuá»³ chá»‰nh nháº¯c nhá»Ÿ">
                          <i class="fas fa-sliders-h"></i>
                        </button>
                      </div>
                    </div>
                    
                    <div class="plant-actions">
                      <button class="action-btn care-btn" (click)="carePlant(plant.plantId); $event.stopPropagation()">
                        <i class="fas fa-heart"></i>
                        <span>ChÄƒm sÃ³c</span>
                      </button>
                      <button class="action-btn edit-btn" (click)="editPlant(plant.userPlantId, plant.nickname); $event.stopPropagation()">
                        <i class="fas fa-edit"></i>
                        <span>Sá»­a</span>
                      </button>
                      <button class="action-btn remove-btn" (click)="removePlantFromCollection(plant.plantId); $event.stopPropagation()">
                        <i class="fas fa-trash"></i>
                        <span>XÃ³a</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>

<!-- Confirmation Dialog -->
<app-confirmation-dialog></app-confirmation-dialog>

<!-- Dialog tuá»³ chá»‰nh nháº¯c nhá»Ÿ tá»«ng loáº¡i -->
@if (showCareReminderDialog) {
  <app-care-reminder-dialog
    [schedules]="careReminderDialogSchedules"
    (save)="onCareReminderDialogSave($event)"
    (close)="onCareReminderDialogClose()"
  ></app-care-reminder-dialog>
}
