<app-top-navigator></app-top-navigator>

<div class="report-plant-page">
  <div class="page-header">
    <div class="header-background"></div>
    <div class="header-content">
      <h1 class="page-title">B√°o c√°o th√¥ng tin c√¢y</h1>
      <p class="page-subtitle">H√£y chia s·∫ª v·ªõi ch√∫ng t√¥i n·∫øu b·∫°n ph√°t hi·ªán th√¥ng tin kh√¥ng ch√≠nh x√°c v·ªÅ c√¢y n√†y</p>
      <div class="header-stats"></div>
    </div>
  </div>

  @if (plant) {
    <div class="report-content">
      <!-- Plant Information Panel -->
      <div class="plant-info-section">
        <div class="section-badge">
          <span class="badge-icon">üå±</span>
          <span class="badge-text">TH√îNG TIN C√ÇY</span>
        </div>
        <div class="plant-header">
          <div class="plant-images">
            <div class="main-image">
              <div class="image-wrapper">
                <img [src]="plant.imageUrls[0] || '/assets/image/logo.png'" [alt]="plant.commonName" class="plant-img" />
              </div>
            </div>
            @if (plant.imageUrls && plant.imageUrls.length > 1) {
              <div class="image-gallery">
                @for (imageUrl of plant.imageUrls.slice(1, 4); track imageUrl) {
                  <div class="gallery-item">
                    <img [src]="imageUrl" [alt]="plant.commonName" class="gallery-img" />
                    <div class="gallery-overlay">
                      <span class="gallery-icon">üîç</span>
                    </div>
                  </div>
                }
                @if (plant.imageUrls.length > 4) {
                  <div class="more-images">
                    <span class="more-count">+{{ plant.imageUrls.length - 4 }}</span>
                    <span class="more-text">·∫£nh kh√°c</span>
                  </div>
                }
              </div>
            }
          </div>
          <div class="plant-basic-info">
            <div class="plant-name-section">
              <h2 class="plant-name">{{ plant.commonName }}</h2>
            </div>
            <p class="plant-scientific">{{ plant.scientificName }}</p>
            <div class="plant-tags">
              <span class="plant-category">
                <span class="category-icon"></span>
                {{ plant.categoryName }}
              </span>
              @if (plant.status) {
                <div class="plant-status">
                  <span class="status-badge" [class]="plant.status.toLowerCase()">
                    <span class="status-icon">{{ plant.status === 'ACTIVE' ? '' : '' }}</span>
                    {{ plant.status === 'ACTIVE' ? 'ƒê√£ x√°c th·ª±c' : 'ƒêang ƒë∆∞·ª£c ki·ªÉm tra b·ªüi admin' }}
                  </span>
                </div>
              }
            </div>
          </div>
        </div>
        <div class="plant-details">
          <div class="detail-section description-section">
            <div class="section-header">
              <h3><span class="section-icon">üìù</span>M√¥ t·∫£ chi ti·∫øt</h3>
              <span class="section-badge">Th√¥ng tin c∆° b·∫£n</span>
            </div>
            <div class="description-content">
              <p>{{ plant.description || 'Ch∆∞a c√≥ m√¥ t·∫£ chi ti·∫øt cho lo·∫°i c√¢y n√†y.' }}</p>
            </div>
          </div>
          <div class="care-requirements">
            <div class="section-header">
              <h3><span class="section-icon">üåø</span>Y√™u c·∫ßu chƒÉm s√≥c</h3>
            </div>
            <div class="care-grid">
              <div class="care-item light-care">
                <div class="care-icon-wrapper">
                  <div class="care-icon">‚òÄÔ∏è</div>
                  <div class="care-indicator light-indicator"></div>
                </div>
                <div class="care-info">
                  <span class="care-label">√Ånh s√°ng</span>
                  <span class="care-value">{{ translateLightRequirement(plant.lightRequirement) }}</span>
                  <div class="care-tips">V·ªã tr√≠: {{ getLightPosition(plant.lightRequirement) }}</div>
                </div>
              </div>
              <div class="care-item water-care">
                <div class="care-icon-wrapper">
                  <div class="care-icon">üíß</div>
                  <div class="care-indicator water-indicator"></div>
                </div>
                <div class="care-info">
                  <span class="care-label">N∆∞·ªõc</span>
                  <span class="care-value">{{ translateWaterRequirement(plant.waterRequirement) }}</span>
                  <div class="care-tips">T·∫ßn su·∫•t: {{ getWaterFrequency(plant.waterRequirement) }}</div>
                </div>
              </div>
              <div class="care-item difficulty-care">
                <div class="care-icon-wrapper">
                  <div class="care-icon">üå±</div>
                  <div class="care-indicator" [class]="getDifficultyClass(plant.careDifficulty)"></div>
                </div>
                <div class="care-info">
                  <span class="care-label">ƒê·ªô kh√≥</span>
                  <span class="care-value">{{ translateCareDifficulty(plant.careDifficulty) }}</span>
                  <div class="care-tips">{{ getDifficultyTip(plant.careDifficulty) }}</div>
                </div>
              </div>
              @if (plant.suitableLocation) {
                <div class="care-item location-care">
                  <div class="care-icon-wrapper">
                    <div class="care-icon">üè†</div>
                    <div class="care-indicator location-indicator"></div>
                  </div>
                  <div class="care-info">
                    <span class="care-label">V·ªã tr√≠ ph√π h·ª£p</span>
                    <span class="care-value">{{ plant.suitableLocation }}</span>
                    <div class="care-tips">M√¥i tr∆∞·ªùng l√Ω t∆∞·ªüng</div>
                  </div>
                </div>
              }
            </div>
          </div>
          <div class="detail-section instructions-section" *ngIf="plant.careInstructions">
            <div class="section-header">
              <h3><span class="section-icon">üìã</span>H∆∞·ªõng d·∫´n chƒÉm s√≥c chi ti·∫øt</h3>
            </div>
            <div class="instructions-content">
              <p>{{ plant.careInstructions }}</p>
            </div>
          </div>
          <div class="detail-section diseases-section" *ngIf="plant.commonDiseases">
            <div class="section-header">
              <h3><span class="section-icon">ü©∫</span>B·ªánh th∆∞·ªùng g·∫∑p</h3>
            </div>
            <div class="diseases-content">
              <p>{{ plant.commonDiseases }}</p>
            </div>
          </div>
          <div class="plant-meta" *ngIf="plant.createdAt">
            <div class="meta-item">
              <span class="meta-icon">üìÖ</span>
              <span class="meta-label">Ng√†y t·∫°o:</span>
              <span class="meta-value">{{ formatDate(plant.createdAt) }}</span>
            </div>
            <div class="meta-item">
              <span class="meta-icon">üîÑ</span>
              <span class="meta-label">C·∫≠p nh·∫≠t g·∫ßn nh·∫•t:</span>
              <span class="meta-value">{{ formatDate(plant.createdAt) }}</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Report Form Panel -->
      <div class="report-form-section">
        <div class="form-header">
          <div class="form-icon">üìù</div>
          <h2>G·ª≠i b√°o c√°o</h2>
          <p>Vui l√≤ng m√¥ t·∫£ chi ti·∫øt v·∫•n ƒë·ªÅ b·∫°n ph√°t hi·ªán ƒë·ªÉ ch√∫ng t√¥i c√≥ th·ªÉ c·∫£i thi·ªán th√¥ng tin</p>
        </div>
        <form (ngSubmit)="submitReport()" class="report-form">
          <div class="form-group">
            <label for="reason" class="form-label">
              <span class="label-icon">üìã</span>
              <span class="label-text">L√Ω do b√°o c√°o</span>
              <span class="label-required">*</span>
            </label>
            <div class="textarea-wrapper">
              <textarea 
                id="reason"
                class="form-textarea" 
                [(ngModel)]="reason" 
                name="reason" 
                rows="6" 
                placeholder="V√≠ d·ª•: Th√¥ng tin chƒÉm s√≥c kh√¥ng ch√≠nh x√°c, h√¨nh ·∫£nh sai, m√¥ t·∫£ thi·∫øu chi ti·∫øt, t√™n khoa h·ªçc kh√¥ng ƒë√∫ng..."
                required 
                autofocus
              ></textarea>
              <div class="textarea-counter">
                <span class="counter-text">{{ reason.length }}/500 k√Ω t·ª±</span>
              </div>
            </div>
            <div class="form-suggestions">
              <div class="suggestion-header">üí° G·ª£i √Ω l√Ω do b√°o c√°o:</div>
              <div class="suggestion-tags">
                <button type="button" class="suggestion-tag" (click)="addSuggestion('Th√¥ng tin chƒÉm s√≥c kh√¥ng ch√≠nh x√°c')">
                  üåø Th√¥ng tin chƒÉm s√≥c sai
                </button>
                <button type="button" class="suggestion-tag" (click)="addSuggestion('H√¨nh ·∫£nh kh√¥ng ph√π h·ª£p')">
                  üì∏ H√¨nh ·∫£nh sai
                </button>
                <button type="button" class="suggestion-tag" (click)="addSuggestion('T√™n khoa h·ªçc kh√¥ng ƒë√∫ng')">
                  üî¨ T√™n khoa h·ªçc sai
                </button>
                <button type="button" class="suggestion-tag" (click)="addSuggestion('M√¥ t·∫£ thi·∫øu chi ti·∫øt')">
                  üìù M√¥ t·∫£ thi·∫øu
                </button>
              </div>
            </div>
          </div>
          <!-- X√≥a errorMsg kh·ªèi template, ch·ªâ d√πng toast -->
          <div class="form-actions">
            <button type="button" class="btn btn-cancel" (click)="goToPlantInfo()" [disabled]="submitting">
              <span class="btn-icon">‚Ü©Ô∏è</span>
              <span class="btn-text">Quay l·∫°i</span>
            </button>
            <button type="submit" class="btn btn-submit" [disabled]="submitting || !reason.trim()">
              <span class="btn-icon" *ngIf="!submitting">üì§</span>
              <div class="btn-loading" *ngIf="submitting">
                <div class="loading-spinner"></div>
              </div>
              <span class="btn-text">{{ submitting ? 'ƒêang g·ª≠i...' : 'G·ª≠i b√°o c√°o' }}</span>
            </button>
          </div>
          <div class="form-footer">
            <div class="privacy-note">
              <span class="privacy-icon">üîí</span>
              <span class="privacy-text">Th√¥ng tin b√°o c√°o c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c b·∫£o m·∫≠t v√† ch·ªâ d√πng ƒë·ªÉ c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng d·ªØ li·ªáu</span>
            </div>
          </div>
        </form>
      </div>
    </div>
  }

  <div class="loading-state" *ngIf="!plant && !errorMsg">
    <div class="loading-spinner">üå±</div>
    <p>ƒêang t·∫£i th√¥ng tin c√¢y...</p>
  </div>

  <div class="error-state" *ngIf="errorMsg && !plant">
    <div class="error-icon">‚ùå</div>
    <h3>Kh√¥ng th·ªÉ t·∫£i th√¥ng tin</h3>
    <p>{{ errorMsg }}</p>
    <button class="btn btn-retry" (click)="goToPlantInfo()">Quay l·∫°i danh s√°ch</button>
  </div>
</div>
