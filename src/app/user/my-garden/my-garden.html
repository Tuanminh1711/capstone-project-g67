<app-top-navigator></app-top-navigator>

<div class="garden-container" (click)="onPageVisible()">
  <!-- Hero Section -->
  <section class="garden-hero">
    <div class="hero-content">
      <h1 class="hero-title">ğŸŒ¿ Khu VÆ°á»n Cá»§a TÃ´i</h1>
      <p class="hero-subtitle">KhÃ´ng gian xanh riÃªng tÆ° nÆ¡i báº¡n chÄƒm sÃ³c nhá»¯ng cÃ¢y cáº£nh yÃªu thÃ­ch</p>
      
      <!-- Statistics - Only show when user has plants -->
      @if (!loading && !error && userPlants.length > 0) {
        <div class="garden-stats">
          <div class="stat-item">
            <div class="stat-number">{{ userPlants.length }}</div>
            <div class="stat-label">CÃ¢y trong vÆ°á»n</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ getReminderEnabledCount() }}</div>
            <div class="stat-label">CÃ³ lá»i nháº¯c</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ getHealthyPlantsCount() }}</div>
            <div class="stat-label">CÃ¢y khá»e máº¡nh</div>
          </div>
        </div>
      }
    </div>
    
    <div class="garden-decoration">
      <div class="floating-leaf">ğŸƒ</div>
      <div class="floating-leaf">ğŸŒ±</div>
      <div class="floating-leaf">ğŸŒ¿</div>
    </div>
  </section>

  <!-- Controls -->
  @if (!loading && !error && userPlants.length > 0) {
    <section class="garden-controls">
      <div class="controls-wrapper">
        <div class="view-controls">
          <button 
            [class.active]="layout === 'garden'" 
            (click)="layout = 'garden'"
            class="control-btn garden-view"
          >
            <span class="btn-icon">ğŸŒ±</span>
            <span>Khu VÆ°á»n</span>
          </button>
          <button 
            [class.active]="layout === 'grid'" 
            (click)="layout = 'grid'"
            class="control-btn grid-view"
          >
            <span class="btn-icon">âŠ</span>
            <span>LÆ°á»›i</span>
          </button>
          <button 
            [class.active]="layout === 'list'" 
            (click)="layout = 'list'"
            class="control-btn list-view"
          >
            <span class="btn-icon">â˜°</span>
            <span>Danh sÃ¡ch</span>
          </button>
        </div>

        <div class="filter-controls">
          <button 
            [class.active]="filter === 'all'" 
            (click)="filter = 'all'"
            class="filter-btn"
          >
            Táº¥t cáº£
          </button>
          <button 
            [class.active]="filter === 'reminder'" 
            (click)="filter = 'reminder'"
            class="filter-btn"
          >
            CÃ³ nháº¯c nhá»Ÿ
          </button>
          <button 
            [class.active]="filter === 'recent'" 
            (click)="filter = 'recent'"
            class="filter-btn"
          >
            Má»›i trá»“ng
          </button>
        </div>
      </div>
    </section>
  }

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-garden">
      <div class="loading-animation">
        <div class="growing-plant">
          <div class="plant-stem"></div>
          <div class="plant-leaves">
            <div class="leaf leaf-1">ğŸŒ¿</div>
            <div class="leaf leaf-2">ğŸƒ</div>
            <div class="leaf leaf-3">ğŸŒ±</div>
          </div>
        </div>
      </div>
      <p class="loading-text">Äang táº£i khu vÆ°á»n cá»§a báº¡n...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="error-garden">
      <div class="error-icon">ğŸ¥€</div>
      <h3>{{ error.includes('Ä‘Äƒng nháº­p') ? 'Cáº§n Ä‘Äƒng nháº­p' : 'Oops! CÃ³ lá»—i xáº£y ra' }}</h3>
      <p>{{ error }}</p>
      <div class="error-actions">
        @if (error.includes('Ä‘Äƒng nháº­p')) {
          <button 
            class="auth-btn"
            (click)="handleAuthRequired()"
          >
            <span>ğŸ”‘</span> ÄÄƒng nháº­p
          </button>
        } @else {
          <button 
            class="retry-btn" 
            (click)="refreshGarden()"
            [disabled]="loading"
          >
            <span>ğŸ”„</span> {{ loading ? 'Äang thá»­ láº¡i...' : 'Thá»­ láº¡i' }}
          </button>
        }
      </div>
    </div>
  }

  <!-- Empty State -->
  @if (!loading && !error && userPlants.length === 0) {
    <div class="empty-garden">
      <div class="empty-illustration">
        <div class="empty-pot">
          <div class="pot-body"></div>
          <div class="pot-soil"></div>
          <div class="sprouting-seed">ğŸŒ±</div>
        </div>
      </div>
      <div class="empty-content">
        <h3>{{ isLoggedIn ? 'Khu vÆ°á»n cá»§a báº¡n Ä‘ang trá»‘ng' : 'ChÃ o má»«ng Ä‘áº¿n vá»›i My Garden!' }}</h3>
        <p>{{ isLoggedIn ? 'HÃ£y báº¯t Ä‘áº§u trá»“ng nhá»¯ng cÃ¢y cáº£nh yÃªu thÃ­ch Ä‘á»ƒ táº¡o nÃªn khu vÆ°á»n xanh tÆ°Æ¡i!' : 'ÄÄƒng nháº­p Ä‘á»ƒ báº¯t Ä‘áº§u táº¡o khu vÆ°á»n xanh cá»§a riÃªng báº¡n!' }}</p>
        @if (isLoggedIn) {
          <button 
            class="start-gardening-btn" 
            (click)="router.navigate(['/plant-info'])"
          >
            <span>ğŸŒ±</span> Báº¯t Ä‘áº§u trá»“ng cÃ¢y
          </button>
        } @else {
          <button 
            class="start-gardening-btn" 
            (click)="handleAuthRequired()"
          >
            <span>ğŸ”‘</span> ÄÄƒng nháº­p Ä‘á»ƒ báº¯t Ä‘áº§u
          </button>
        }
      </div>
    </div>
  }

  <!-- Plants Display -->
  @if (!loading && !error && userPlants.length > 0) {
    <div class="plants-display">
      
      <!-- Garden Layout -->
      @if (layout === 'garden') {
        <div class="garden-layout">
          <div class="garden-ground">
            <div class="garden-path"></div>
            <div class="plants-garden">
              @for (plant of filteredPlants; track plant.plantId; let i = $index) {
                <div 
                  class="plant-spot"
                  [class.spot-left]="i % 2 === 0"
                  [class.spot-right]="i % 2 === 1"
                  [style.animation-delay]="i * 0.1 + 's'"
                >
                  <div class="plant-pot" (click)="viewPlantDetail(plant.plantId)">
                    <div class="pot-base"></div>
                    <div class="plant-image">
                      <span class="plant-emoji">ğŸŒ¿</span>
                    </div>
                    <div class="plant-glow"></div>
                  </div>
                  
                  <div class="plant-info-card">
                    <h3 class="plant-name">{{ plant.nickname || 'CÃ¢y khÃ´ng tÃªn' }}</h3>
                    <div class="plant-details">
                      <div class="detail-row">
                        <span class="detail-icon">ğŸ“</span>
                        <span class="detail-text">{{ plant.plantLocation }}</span>
                      </div>
                      <div class="detail-row">
                        <span class="detail-icon">ğŸ“…</span>
                        <span class="detail-text">ÄÃ£ trá»“ng</span>
                      </div>
                      @if (plant.reminderEnabled) {
                        <div class="detail-row">
                          <span class="detail-icon">ğŸ””</span>
                          <span class="detail-text">CÃ³ lá»i nháº¯c</span>
                        </div>
                      }
                    </div>
                    <div class="plant-actions">
                      <button class="action-btn care-btn" (click)="carePlant(plant.plantId); $event.stopPropagation()">
                        <span>ChÄƒm sÃ³c</span>
                      </button>
                      <button class="action-btn edit-btn" (click)="editPlant(plant.plantId, plant.nickname); $event.stopPropagation()">
                        <span>Chá»‰nh sá»­a</span>
                      </button>
                      <button class="action-btn remove-btn" (click)="removePlantFromCollection(plant.plantId); $event.stopPropagation()">
                        <span>XÃ³a</span>
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      }

      <!-- Grid Layout -->
      @if (layout === 'grid') {
        <div class="grid-layout">
          <div class="plants-grid">
            @for (plant of filteredPlants; track plant.plantId; let i = $index) {
              <div 
                class="plant-card"
                [style.animation-delay]="i * 0.1 + 's'"
              >
                <div class="card-header">
                  <div class="plant-image-container">
                    <img 
                      src="/assets/image/logo.png" 
                      [alt]="plant.nickname"
                      class="plant-image"
                    />
                    <div class="image-overlay">
                      <button 
                        class="overlay-btn"
                        (click)="viewPlantDetail(plant.plantId)"
                      >
                        <span>ğŸ‘ï¸</span>
                      </button>
                    </div>
                  </div>
                </div>
                
                <div class="card-body">
                  <h3 class="plant-title">{{ plant.nickname }}</h3>
                  <div class="plant-meta">
                    <div class="meta-item">
                      <span class="meta-icon">ğŸ“</span>
                      <span class="meta-text">{{ plant.plantLocation }}</span>
                    </div>
                    <div class="meta-item">
                      <span class="meta-icon">ğŸ“…</span>
                      <span class="meta-text">ÄÃ£ trá»“ng</span>
                    </div>
                  </div>
                  
                  <div class="plant-status">
                    <div class="status-indicator" [class.active]="plant.reminderEnabled">
                      <span class="status-icon">ğŸ””</span>
                      <span class="status-text">{{ plant.reminderEnabled ? 'CÃ³ nháº¯c nhá»Ÿ' : 'KhÃ´ng nháº¯c nhá»Ÿ' }}</span>
                    </div>
                  </div>
                </div>
                
                <div class="card-footer">
                  <button 
                    class="card-btn primary"
                    (click)="viewPlantDetail(plant.plantId)"
                  >
                    Chi tiáº¿t
                  </button>
                  <button 
                    class="card-btn secondary"
                    (click)="editPlant(plant.plantId, plant.nickname)"
                  >
                    Sá»­a
                  </button>
                  <button 
                    class="card-btn secondary"
                    (click)="removePlantFromCollection(plant.plantId)"
                  >
                    XÃ³a
                  </button>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- List Layout -->
      @if (layout === 'list') {
        <div class="list-layout">
          <div class="plants-list">
            @for (plant of filteredPlants; track plant.plantId; let i = $index) {
              <div 
                class="plant-list-item"
                [style.animation-delay]="i * 0.05 + 's'"
              >
                <div class="list-item-image">
                  <img 
                    src="/assets/image/logo.png" 
                    [alt]="plant.nickname"
                  />
                </div>
                
                <div class="list-item-content">
                  <div class="content-header">
                    <h3 class="plant-name">{{ plant.nickname }}</h3>
                    <div class="plant-age">ÄÃ£ trá»“ng</div>
                  </div>
                  
                  <div class="content-details">
                    <div class="detail-group">
                      <span class="detail-icon">ğŸ“</span>
                      <span>{{ plant.plantLocation }}</span>
                    </div>
                    <div class="detail-group">
                      <span class="detail-icon">ğŸ“…</span>
                      <span>ÄÆ°á»£c thÃªm vÃ o vÆ°á»n</span>
                    </div>
                    @if (plant.reminderEnabled) {
                      <div class="detail-group">
                        <span class="detail-icon">ğŸ””</span>
                        <span>Nháº¯c nhá»Ÿ Ä‘Ã£ báº­t</span>
                      </div>
                    }
                  </div>
                </div>
                
                <div class="list-item-actions">
                  <button 
                    class="list-action-btn view"
                    (click)="viewPlantDetail(plant.plantId)"
                  >
                    <span>ğŸ‘ï¸</span> Xem
                  </button>
                  <button 
                    class="list-action-btn edit"
                    (click)="editPlant(plant.plantId, plant.nickname)"
                  >
                    <span>âœï¸</span> Sá»­a
                  </button>
                  <button 
                    class="list-action-btn remove"
                    (click)="removePlantFromCollection(plant.plantId)"
                  >
                    <span>ğŸ—‘ï¸</span> XÃ³a
                  </button>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</div>

<!-- Confirmation Dialog -->
<app-confirmation-dialog></app-confirmation-dialog>
