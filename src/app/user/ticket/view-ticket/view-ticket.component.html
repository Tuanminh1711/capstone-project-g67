<app-top-navigator></app-top-navigator>
<div class="ticket-list-wrapper" style="margin-top: 64px;">
  <h2>Danh sách Ticket hỗ trợ</h2>
  <div *ngIf="loading" class="loading">Đang tải...</div>
  <div *ngIf="error" class="error">{{ error }}</div>
  <table *ngIf="(tickets$ | async)?.length && !selectedTicket" class="ticket-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Tiêu đề</th>
        <th>Mô tả</th>
        <th>Trạng thái</th>
        <th>Ngày tạo</th>
        <th>Phản hồi</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let ticket of (tickets$ | async)">
        <td>{{ ticket.ticketId }}</td>
        <td>{{ ticket.title }}</td>
        <td>{{ ticket.description }}</td>
        <td>
          {{
            ticket.status === 'OPEN' ? 'Đang mở' :
            ticket.status === 'CLOSED' ? 'Đã đóng' :
            ticket.status === 'CLAIMED' ? 'Đã nhận' :
            ticket.status === 'IN_PROGRESS' ? 'Đang xử lý' :
            ticket.status
          }}
        </td>
        <td>{{ ticket.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
        <td>{{ ticket.responseCount }}</td>
        <td><button class="btn btn-link" (click)="viewDetail(ticket)">Xem chi tiết</button></td>
      </tr>
    </tbody>
  </table>

  <!-- Ticket Detail View (tách component) -->
  <app-ticket-detail *ngIf="selectedTicket" [ticket]="selectedTicket" (close)="closeDetail()"></app-ticket-detail>
  <div *ngIf="!loading && !(tickets$ | async)?.length && !error" class="empty">Không có ticket nào.</div>
</div>
