  <div class="chat-container">
    <div class="chat-header">
      <div class="header-left">
        <div class="chat-avatar">
          <span>E</span>
        </div>
        <div class="chat-info">
          <h2 class="chat-title">Phòng Chat Cộng Đồng</h2>
          <p class="chat-subtitle">Kết nối với cộng đồng yêu cây cảnh</p>
        </div>
      </div>
    </div>

    <div class="chat-messages" #messagesContainer>
      <div *ngIf="loading" class="loading-state">
        <div class="text">Đang tải tin nhắn...</div>
      </div>

      <div *ngIf="error && !loading" class="error-state">
        <div class="text">{{ error }}</div>
        <button class="retry-btn" (click)="connectToChat()">Thử lại</button>
      </div>

      <div *ngIf="!loading && messages.length === 0" class="empty-state">
        <div class="text">Chưa có tin nhắn nào</div>
        <div class="subtext">Hãy bắt đầu cuộc trò chuyện với cộng đồng!</div>
      </div>

      <div *ngIf="!loading && messages.length > 0" class="messages-list">
        <div *ngFor="let msg of messages; trackBy: trackMessage; let last = last" 
             class="message-wrapper"
             [class.own-message]="isOwnMessage(msg)"
             [class.other-message]="!isOwnMessage(msg)">
          
          <!-- Avatar cho tin nhắn của người khác (bên trái) -->
          <div class="message-avatar" *ngIf="!isOwnMessage(msg)">
            <span>{{ getAvatarInitial(msg) }}</span>
          </div>
          
          <div class="message-bubble">
            <div class="message-content">
              <div class="message-info">
                <span class="sender-name">{{ getSenderName(msg) }}</span>
                <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
              </div>
              <div class="message-text">
                {{ msg.content }}
              </div>
            </div>
          </div>
          
          <!-- Avatar cho tin nhắn của mình (bên phải) -->
          <div class="message-avatar own-avatar" *ngIf="isOwnMessage(msg)">
            <span>{{ getAvatarInitial(msg) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input Area - Đơn giản hóa -->
    <div class="chat-input-container">
      <form class="message-form" (ngSubmit)="sendMessage()" #chatForm="ngForm">
        <textarea 
          class="message-input" 
          [(ngModel)]="newMessage" 
          name="message"
          placeholder="Nhập tin nhắn tư vấn cho cộng đồng..."
          rows="1"
          maxlength="1000"
          (keydown.enter)="onEnterPress($event)"
          #messageInput></textarea>
        
        <button 
          type="submit" 
          class="send-button"
          [disabled]="newMessage.trim().length === 0">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </form>
      
      <div class="input-footer">
        <div class="char-counter" [class.warning]="newMessage.length > 800">
          {{ newMessage.length }}/1000
        </div>
      </div>
    </div>
  </div>
