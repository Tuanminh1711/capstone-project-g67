<div class="admin-account-list-container">
  @if (accounts$ | async; as accounts) {
  <!-- Removed header and update button as requested -->
    <div class="message-bar-wrapper">
      @if (errorMsg) {
        <div class="error-bar message-bar">{{ errorMsg }}</div>
      }
      @if (successMsg) {
        <div class="success-bar message-bar">{{ successMsg }}</div>
      }
    </div>
    <div class="search-bar-modern">
      <div class="search-input-wrapper">
        <input
          type="text"
          class="search-input-modern"
          placeholder="Tìm kiếm tài khoản (tên đăng nhập, email, họ tên...)"
          [(ngModel)]="searchText"
          (input)="onSearchInputChange()"
          autocomplete="off"
        />
        <span class="search-icon">
          <i class="fas fa-search"></i>
        </span>
      </div>
    </div>
    <div class="table-wrapper">
      <table class="account-table">
        <thead>
          <tr>
            <th (click)="sortBy('username')">Tên đăng nhập</th>
            <th (click)="sortBy('fullName')">Họ tên</th>
            <th (click)="sortBy('email')">Email</th>
            <th (click)="sortBy('role')">Vai trò</th>
            <th (click)="sortBy('status')">Trạng thái</th>
            <th>Thao tác</th>
          </tr>
        </thead>
        <tbody>
          @for (acc of accounts; track acc.id) {
            <tr>
              <td>
                <a (click)="viewDetail(acc)" class="account-link">{{ acc.username }}</a>
              </td>
              <td>
                <a (click)="viewDetail(acc)" class="account-link">{{ acc.fullName }}</a>
              </td>
              <td>{{ acc.email }}</td>
              <td>{{ acc.role | titlecase }}</td>
              <td>
                <select class="status-dropdown" [ngClass]="{
                  'active': (acc.status || '').toLowerCase() === 'active',
                  'banned': (acc.status || '').toLowerCase() === 'banned'
                }" [value]="(acc.status || 'ACTIVE').toUpperCase()" (change)="changeStatus(acc, $event)" [disabled]="(acc.id + '') === (currentUserId + '')"
                  [title]="(acc.id + '') === (currentUserId + '') ? 'Bạn không thể thay đổi trạng thái của chính mình' : ''">
                  <option value="ACTIVE">Hoạt động</option>
                  <option value="BANNED">Cấm</option>
                </select>
              </td>
              <td>
                <div class="action-buttons">
          <button class="edit-btn" (click)="editUser(acc)" [title]="acc.role && acc.role.toUpperCase() === 'VIP' ? 'Không thể chỉnh sửa tài khoản VIP' : 'Chỉnh sửa tài khoản'">
            <i class="fas fa-edit"></i>
          </button>
                  <button class="logs-btn" (click)="viewActivityLogs(acc)" title="Xem nhật ký hoạt động">
                    <i class="fas fa-history"></i>
                  </button>
                    <button 
                      class="reset-btn" 
                      (click)="resetPassword(acc)" 
                      [title]="(acc.id + '') !== (currentUserId + '') ? 'Chỉ có thể đặt lại mật khẩu của chính mình' : 'Đặt lại mật khẩu'" 
                      [disabled]="(acc.id + '') !== (currentUserId + '')">
                      <i class="fas fa-key"></i>
                    </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    @if (accounts && accounts.length > 0) {
      <div class="pagination-bar">
        <button class="pagination-btn" (click)="prevPage()" [disabled]="pageNo === 0">
          <i class="fas fa-chevron-left"></i>
        </button>
        <span class="pagination-index">{{ pageNo + 1 }} / {{ totalPages }}</span>
        <button class="pagination-btn" (click)="nextPage()" [disabled]="pageNo + 1 >= totalPages">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    }
    @if (loading) {
      <div class="loading-bar">Đang tải...</div>
    }
  }
