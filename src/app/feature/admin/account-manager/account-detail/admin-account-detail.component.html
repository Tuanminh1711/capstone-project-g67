<div class="admin-account-detail-container">
  <div class="detail-header">
    <h2>Chi tiết tài khoản</h2>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="viewActivityLogs()">
        <i class="fas fa-history"></i>
        Nhật ký hoạt động
      </button>
      <!-- Ẩn nút chỉnh sửa nếu là tài khoản VIP hoặc không có quyền -->
      @if (showAllInfo) {
        <button class="btn btn-primary" (click)="editUser()">
          <i class="fas fa-edit"></i>
          Chỉnh sửa
        </button>
      }
    </div>
  </div>

  @if (loading) {
    <div class="loading-bar">
      <i class="fas fa-spinner fa-spin"></i>
      Đang tải thông tin...
    </div>
  }

  @if (errorMsg && !loading) {
    <div class="error-bar">
      {{ errorMsg }}
      @if (canView) {
        <button class="retry-btn" (click)="loadUserDetail()">
          <i class="fas fa-redo"></i>
          Thử lại
        </button>
      }
    </div>
  }

  @if (user && !loading && !errorMsg && canView) {
    <div class="user-detail-card">
      <!-- Avatar and Basic Info -->
      <div class="user-header">
        <div class="user-avatar">
          @if (hasUserAvatar()) {
            <img [src]="getUserAvatarSrc()" 
                 [alt]="user.fullName" 
                 class="avatar-image"
                 (error)="onAvatarError($event)">
          }
          <div class="avatar-placeholder" [style.display]="hasUserAvatar() ? 'none' : 'flex'">
            <i class="fas fa-user"></i>
          </div>
        </div>
        <div class="user-basic-info">
          <h3 class="user-fullname">{{ user.fullName }}</h3>
          <p class="user-username">{{ '@' + user.username }}</p>
          <div class="user-status-role">
            <span class="status-badge" [ngClass]="getStatusClass(user.status)">
              {{ getStatusText(user.status) }}
            </span>
            <span class="role-badge">
              {{ getRoleText(user.role) }}
            </span>
          </div>
        </div>
      </div>

      <!-- Chỉ hiển thị thông tin chi tiết nếu showAllInfo true -->
      @if (showAllInfo) {
        <div class="user-details">
          <div class="detail-section">
            <h4>Thông tin liên hệ</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Email:</span>
                <span class="value">{{ user.email }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Số điện thoại:</span>
                <span class="value">{{ user.phone || 'Chưa có thông tin' }}</span>
              </div>
              @if (user.address) {
                <div class="detail-item">
                  <span class="label">Địa chỉ:</span>
                  <span class="value">{{ user.address }}</span>
                </div>
              }
              @if (user.birthDate) {
                <div class="detail-item">
                  <span class="label">Ngày sinh:</span>
                  <span class="value">{{ formatDate(user.birthDate) }}</span>
                </div>
              }
            </div>
          </div>

          <div class="detail-section">
            <h4>Thông tin cá nhân</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Giới tính:</span>
                <span class="value">{{ getGenderText(user.gender || '') }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4>Thông tin hệ thống</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">ID:</span>
                <span class="value">#{{ user.id }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Vai trò:</span>
                <span class="value">{{ getRoleText(user.role) }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Trạng thái:</span>
                <span class="value" [ngClass]="getStatusClass(user.status)">
                  {{ getStatusText(user.status) }}
                </span>
              </div>
              @if (user.updatedAt) {
                <div class="detail-item">
                  <span class="label">Cập nhật lần cuối:</span>
                  <span class="value">{{ formatDate(user.updatedAt) }}</span>
                </div>
              }
              @if (user.lastLoginAt) {
                <div class="detail-item">
                  <span class="label">Đăng nhập lần cuối:</span>
                  <span class="value">{{ formatDate(user.lastLoginAt) }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      }

      <!-- Nếu chỉ được xem username và vai trò -->
      @if (showOnlyUsernameAndRole && !showAllInfo) {
        <div class="user-details">
          <div class="detail-section">
            <h4>Thông tin được phép xem</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="label">Tên đăng nhập:</span>
                <span class="value">{{ user.username }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Vai trò:</span>
                <span class="value">{{ getRoleText(user.role) }}</span>
              </div>
            </div>
            <div class="info-restriction-notice">
              <i class="fas fa-info-circle"></i>
              <span>Thông tin chi tiết bị ẩn do quyền hạn</span>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
