<!-- Giao diện chuyên nghiệp, tối giản, không lạm dụng icon -->
<div class="update-plant-page">
  <div class="update-plant-header">
    <h1>Chỉnh sửa thông tin cây cảnh</h1>
    <p class="subtitle">Cập nhật chi tiết, hình ảnh và thông tin chăm sóc</p>
  </div>

  <div *ngIf="loading" class="loading-section">
    <div class="loading-card">
      <div class="loading-spinner-large"></div>
      <h3>Đang tải thông tin cây cảnh...</h3>
    </div>
  </div>

  <div *ngIf="errorMsg" class="alert error">{{ errorMsg }}</div>
  <div *ngIf="successMsg" class="alert success">{{ successMsg }}</div>
  <div *ngIf="validationErrors.length > 0" class="alert warning">
    <ul>
      <li *ngFor="let error of validationErrors">{{ error }}</li>
    </ul>
  </div>

  <div *ngIf="plant && !loading" class="update-plant-content">
    <div class="plant-image-block">
      <div *ngIf="(plant.images && plant.images.length > 0) || (plant.imageUrls && plant.imageUrls.length > 0)" class="plant-image-gallery">
        <ng-container *ngIf="plant.images && plant.images.length > 0; else showImageUrls">
          <div *ngFor="let img of plant.images.slice(-3)" class="plant-image-item">
            <img [src]="getPlantImageSrc(img.imageUrl)" [alt]="plant.commonName" (error)="onImageError($event)" [class.primary-image]="img.isPrimary" />
          </div>
        </ng-container>
        <ng-template #showImageUrls>
          <div *ngFor="let url of plant.imageUrls.slice(-3)" class="plant-image-item">
            <img [src]="getPlantImageSrc(url)" [alt]="plant.commonName" (error)="onImageError($event)" />
          </div>
        </ng-template>
      </div>

      <div class="plant-image-upload-block">
        <div class="upload-center">
          <label class="image-upload-plus" [class.disabled]="isUploadingImage">
            <input type="file" accept="image/*" (change)="onNewImageFileSelected($event)" [disabled]="isUploadingImage" hidden />
            <div class="upload-img-frame">
              <ng-container *ngIf="selectedNewImageFile; else showPlaceholder">
                <img [src]="newImagePreviewUrl" alt="Preview" class="preview-img" />
              </ng-container>
              <ng-template #showPlaceholder>
                <div class="upload-placeholder">
                  <svg class="upload-img-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="8" y="12" width="32" height="24" rx="4" fill="#e8f5e9"/>
                    <rect x="8" y="12" width="32" height="24" rx="4" stroke="#43b06d" stroke-width="2"/>
                    <circle cx="18" cy="22" r="3" fill="#c8e6c9" stroke="#43b06d" stroke-width="1.5"/>
                    <path d="M13 32L20 25L28 33L33 28L39 34" stroke="#43b06d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <div class="upload-placeholder-text">Thêm ảnh mới</div>
                </div>
              </ng-template>
            </div>
          </label>
          <button *ngIf="selectedNewImageFile" type="button" class="upload-btn-abs" (click)="onUploadNewImage()" [disabled]="isUploadingImage">
            {{ isUploadingImage ? 'Đang tải lên...' : 'Thêm ảnh mới' }}
          </button>
        </div>
      </div>
      <div *ngIf="!plant.imageUrls || plant.imageUrls.length === 0" class="no-image">
        Không có ảnh
      </div>
    </div>
    <form (ngSubmit)="onSubmit()" #plantForm="ngForm" class="plant-form-block">
      <div class="form-row">
        <div class="form-group">
          <label for="commonName">Tên thường gọi *</label>
        <input id="commonName" type="text" [(ngModel)]="updateForm.commonName" name="commonName" required #commonName="ngModel" (ngModelChange)="onFieldChange()" />
        </div>
        <div class="form-group">
          <label for="scientificName">Tên khoa học *</label>
        <input id="scientificName" type="text" [(ngModel)]="updateForm.scientificName" name="scientificName" required #scientificName="ngModel" (ngModelChange)="onFieldChange()" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="categoryId">ID Danh mục *</label>
        <input id="categoryId" type="number" [(ngModel)]="updateForm.categoryId" name="categoryId" required min="1" (ngModelChange)="onFieldChange()" />
        </div>
        <div class="form-group">
          <label for="status">Trạng thái *</label>
        <select id="status" [(ngModel)]="updateForm.status" name="status" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of statusOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="lightRequirement">Yêu cầu ánh sáng *</label>
        <select id="lightRequirement" [(ngModel)]="updateForm.lightRequirement" name="lightRequirement" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of lightRequirementOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="waterRequirement">Yêu cầu nước *</label>
        <select id="waterRequirement" [(ngModel)]="updateForm.waterRequirement" name="waterRequirement" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of waterRequirementOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="careDifficulty">Độ khó chăm sóc *</label>
        <select id="careDifficulty" [(ngModel)]="updateForm.careDifficulty" name="careDifficulty" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of careDifficultyOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="suitableLocation">Vị trí phù hợp</label>
          <select id="suitableLocation" [(ngModel)]="updateForm.suitableLocation" name="suitableLocation" (ngModelChange)="onFieldChange()" required>
            <option value="">-- Chọn vị trí phù hợp --</option>
            <option *ngFor="let option of suitableLocationOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="description">Mô tả về cây</label>
        <textarea id="description" [(ngModel)]="updateForm.description" name="description" rows="3" (ngModelChange)="onFieldChange()"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="careInstructions">Hướng dẫn chăm sóc</label>
        <textarea id="careInstructions" [(ngModel)]="updateForm.careInstructions" name="careInstructions" rows="3" (ngModelChange)="onFieldChange()"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="commonDiseases">Bệnh thường gặp</label>
        <input id="commonDiseases" type="text" [(ngModel)]="updateForm.commonDiseases" name="commonDiseases" (ngModelChange)="onFieldChange()" />
        </div>
      </div>
      <div class="form-actions">
        <button type="button" (click)="resetForm()" [disabled]="isUpdating" class="btn ghost">Đặt lại</button>
        <button type="button" (click)="onCancel()" [disabled]="isUpdating" class="btn secondary">Hủy bỏ</button>
        <button type="submit" [disabled]="!plantForm.valid || isUpdating" class="btn primary">
          {{ isUpdating ? 'Đang cập nhật...' : 'Lưu thông tin' }}
        </button>
      </div>
    </form>
  </div>
</div>
