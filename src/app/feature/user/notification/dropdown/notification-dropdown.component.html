<div class="notification-dropdown-container">
  <!-- Notification Badge Trigger -->
  <div class="notification-trigger" (click)="toggleDropdown()">
    <app-notification-badge></app-notification-badge>
  </div>

  <!-- Dropdown Menu -->
  <div class="notification-dropdown" [class.open]="isOpen">
    <div class="dropdown-header">
      <h4>
        <i class="fas fa-bell"></i>
        Thông báo
      </h4>
      @if (notifications.length > 0) {
        <button 
          class="btn-mark-all-read"
          (click)="markAllAsRead()"
          title="Đánh dấu tất cả đã đọc">
          <i class="fas fa-check-double"></i>
        </button>
      }
    </div>

    <!-- Loading state -->
    @if (isLoading) {
      <div class="dropdown-loading">
        <div class="spinner-small"></div>
        <span>Đang tải...</span>
      </div>
    }

    <!-- No notifications -->
    @if (!isLoading && notifications.length === 0) {
      <div class="dropdown-empty">
        <i class="fas fa-bell-slash"></i>
        <p>Không có thông báo mới</p>
      </div>
    }

    <!-- Notification List -->
    @if (!isLoading && notifications.length > 0) {
      <div class="dropdown-list">
  @for (notification of notifications; track trackByNotificationId(i, notification); let i = $index) {
          <div 
            class="dropdown-item"
            [ngClass]="getNotificationClass(toNotificationType(notification.type))"
            (click)="onNotificationClick(notification, $event)">
            <div class="item-icon">
              <i [class]="getNotificationIcon(toNotificationType(notification.type))"></i>
            </div>
            <div class="item-content">
              <div class="item-title">{{ truncateText(notification.title, 40) }}</div>
              <div class="item-message">{{ truncateText(notification.message, 50) }}</div>
              <div class="item-time">{{ formatTime(notification.createdAt) }}</div>
            </div>
            @if (!notification.isRead) {
              <div class="item-indicator">
                <i class="fas fa-circle"></i>
              </div>
            }
          </div>
        }
      </div>
    }

    <!-- Footer -->
    <div class="dropdown-footer">
      <a routerLink="/user/notification" class="btn-view-all" (click)="isOpen = false">
        <i class="fas fa-eye"></i>
        Xem tất cả thông báo
      </a>
    </div>
  </div>

  <!-- Overlay -->
    @if (isOpen) {
      <div class="dropdown-overlay" (click)="isOpen = false"></div>
    }
</div>
