<app-top-navigator></app-top-navigator>

<div class="change-password-page">
  <div class="change-password-container">
    <div class="change-password-header">
      <h1>ĐỔI MẬT KHẨU</h1>
    </div>
    
    <div class="change-password-card">
      <div class="card-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
        </svg>
      </div>
      <form (ngSubmit)="changePassword()" #passwordForm="ngForm">
        <div class="form-group">
          <label for="oldPassword">Mật khẩu hiện tại <span class="required">*</span></label>
          <div class="password-input-wrapper">
            <input 
              [type]="showOldPassword ? 'text' : 'password'" 
              id="oldPassword"
              [(ngModel)]="oldPassword" 
              name="oldPassword" 
              placeholder="Nhập mật khẩu hiện tại"
              required
              #oldPasswordInput="ngModel" />
            <button 
              type="button" 
              class="password-toggle"
              (click)="togglePasswordVisibility('old')">
              <svg *ngIf="!showOldPassword" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
              </svg>
              <svg *ngIf="showOldPassword" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="newPassword">Mật khẩu mới <span class="required">*</span></label>
          <div class="password-input-wrapper">
            <input 
              [type]="showNewPassword ? 'text' : 'password'" 
              id="newPassword"
              [(ngModel)]="newPassword" 
              name="newPassword" 
              placeholder="Nhập mật khẩu mới (gồm ít nhất 8 ký tự và 1 chữ in hoa 1 chữ thường)"
              required
              minlength="8"
              #newPasswordInput="ngModel" />
            <button 
              type="button" 
              class="password-toggle"
              (click)="togglePasswordVisibility('new')">
              <svg *ngIf="!showNewPassword" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
              </svg>
              <svg *ngIf="showNewPassword" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"/>
              </svg>
            </button>
          </div>
          <!-- Validation messages for new password -->
          <div *ngIf="newPasswordInput.touched && newPasswordInput.invalid" class="validation-error">
            <div *ngIf="newPasswordInput.errors?.['required']">Mật khẩu mới là bắt buộc</div>
            <div *ngIf="newPasswordInput.errors?.['minlength']">Mật khẩu phải có ít nhất 6 ký tự</div>
          </div>
          <div *ngIf="newPassword && oldPassword && !passwordsDifferent" class="validation-error">
            Mật khẩu mới phải khác mật khẩu cũ
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Xác nhận mật khẩu mới <span class="required">*</span></label>
          <div class="password-input-wrapper">
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'" 
              id="confirmPassword"
              [(ngModel)]="confirmPassword" 
              name="confirmPassword" 
              placeholder="Nhập lại mật khẩu mới"
              required
              #confirmPasswordInput="ngModel" />
            <button 
              type="button" 
              class="password-toggle"
              (click)="togglePasswordVisibility('confirm')">
              <svg *ngIf="!showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
              </svg>
              <svg *ngIf="showConfirmPassword" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.09L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.76,7.13 11.37,7 12,7Z"/>
              </svg>
            </button>
          </div>
          <!-- Validation messages for confirm password -->
          <div *ngIf="confirmPasswordInput.touched && confirmPasswordInput.invalid" class="validation-error">
            <div *ngIf="confirmPasswordInput.errors?.['required']">Xác nhận mật khẩu là bắt buộc</div>
          </div>
          <div *ngIf="confirmPassword && newPassword && !passwordsMatch" class="validation-error">
            Mật khẩu xác nhận không khớp
          </div>
        </div>

        <!-- Success/Error Messages -->
        <div *ngIf="message" class="success-message">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
          </svg>
          {{ message }}
        </div>
        <div *ngIf="error" class="error-message">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13,13H11V7H13M11,15H13V17H11M15.73,3H8.27L3,8.27V15.73L8.27,21H15.73L21,15.73V8.27L15.73,3Z"/>
          </svg>
          {{ error }}
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="change-password-button"
            [disabled]="loading || passwordForm.invalid || !passwordsMatch || !passwordsDifferent">
            <span *ngIf="loading" class="loading-spinner"></span>
            <svg *ngIf="!loading" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"/>
            </svg>
            <span *ngIf="loading">Đang xử lý...</span>
            <span *ngIf="!loading">Đổi mật khẩu</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
