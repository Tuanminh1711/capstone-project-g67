<app-top-navigator></app-top-navigator>

<div class="ai-plant-container">
  <div class="header">
    <h1>ü§ñ AI Nh·∫≠n Di·ªán C√¢y</h1>
    <p>S·ª≠ d·ª•ng AI ƒë·ªÉ nh·∫≠n di·ªán lo·∫°i c√¢y t·ª´ h√¨nh ·∫£nh ho·∫∑c t√¨m ki·∫øm trong c∆° s·ªü d·ªØ li·ªáu</p>


  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'upload'"
      (click)="setActiveTab('upload')">
      üì∑ T·∫£i ·∫£nh l√™n
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'search'"
      (click)="setActiveTab('search')">
      üîç T√¨m ki·∫øm
    </button>
  </div>

  <!-- Upload Tab -->
  <div class="tab-content" *ngIf="activeTab === 'upload'">
    <div class="upload-section">
      <div class="file-upload" *ngIf="!selectedFile">
        <input 
          type="file" 
          id="file-input" 
          accept="image/*" 
          (change)="onFileSelected($event)"
          style="display: none;">
        <label for="file-input" class="upload-area">
          <div class="upload-icon">üì∏</div>
          <div class="upload-text">
            <strong>Ch·ªçn h√¨nh ·∫£nh c√¢y</strong>
            <span>K√©o th·∫£ ho·∫∑c click ƒë·ªÉ ch·ªçn file</span>
            <span style="color: #888; font-size: 13px;"> (Dung l∆∞·ª£ng t·ªëi ƒëa: 20MB)</span>
          </div>
        </label>
      </div>

      <div class="image-preview" *ngIf="selectedFile">
        <div class="preview-container">
          <img [src]="previewUrl" alt="Preview" class="preview-image">
          <button class="remove-btn" (click)="removeFile()">‚úï</button>
          <div class="validating-overlay" *ngIf="isValidating">
            <div class="spinner"></div>
            <span>ƒêang ki·ªÉm tra h√¨nh ·∫£nh...</span>
          </div>
        </div>
        
        <div class="file-info">
          <p><strong>T·ªáp:</strong> {{selectedFile.name}}</p>
          <p><strong>K√≠ch th∆∞·ªõc:</strong> {{(selectedFile.size / 1024 / 1024).toFixed(2)}} MB</p>
        </div>

        

        <div class="identification-options">
          <div class="option-group">
            <label>S·ªë k·∫øt qu·∫£ t·ªëi ƒëa:</label>
            <select [(ngModel)]="maxResults">
              <option value="3">3</option>
              <option value="5">5</option>
              <option value="10">10</option>
            </select>
          </div>
          
          <div class="option-group">
            <label>Ng√¥n ng·ªØ:</label>
            <select [(ngModel)]="language">
              <option value="vi">Ti·∫øng Vi·ªát</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>

        <button 
          class="identify-btn" 
          (click)="identifyPlant()" 
          [disabled]="isLoading">
          <span *ngIf="!isLoading">üîç Nh·∫≠n di·ªán c√¢y</span>
          <span *ngIf="isLoading">
            <div class="spinner-small"></div>
            ƒêang nh·∫≠n di·ªán...
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Search Tab -->
  <div class="tab-content" *ngIf="activeTab === 'search'">
    <div class="search-section">
      <div class="search-input-group">
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          placeholder="Nh·∫≠p t√™n c√¢y c·∫ßn t√¨m..."
          class="search-input"
          (keyup.enter)="searchPlantsInDatabase()">
        <button 
          class="search-btn" 
          (click)="searchPlantsInDatabase()" 
          [disabled]="isLoading">
          <span *ngIf="!isLoading">üîç</span>
          <div *ngIf="isLoading" class="spinner-small"></div>
        </button>
      </div>
      <p class="search-hint">V√≠ d·ª•: "Hoa h·ªìng", "C√¢y xanh", "Succulent"...</p>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section" *ngIf="results.length > 0">
    <h3>K·∫øt qu·∫£ ({{results.length}})</h3>
    
    <div class="results-grid">
      <div class="result-card" *ngFor="let result of results">
        <div class="result-header">
          <h4>{{result.vietnameseName || result.commonName || result.scientificName}}</h4>
          <div class="confidence-badge" [style.background-color]="getConfidenceColor(result.confidence)">
            {{(result.confidence * 100).toFixed(0)}}% - {{getConfidenceText(result.confidence)}}
          </div>
        </div>
        
        <div class="result-content">
          <p class="scientific-name">
            <strong>T√™n khoa h·ªçc: </strong> 
            <em>{{result.scientificName}}</em>
          </p>
          
          <div class="name-info">
            <p *ngIf="result.commonName"><strong>T√™n th√¥ng th∆∞·ªùng: </strong> {{result.commonName}}</p>
            <p *ngIf="result.vietnameseName"><strong>T√™n Vi·ªát Nam: </strong> {{result.vietnameseName}}</p>
          </div>
          
          <div class="description" *ngIf="result.description">
            <h5>M√¥ t·∫£: </h5>
            <p>{{result.description}}</p>
          </div>
          
          <div class="care-instructions" *ngIf="result.careInstructions">
            <h5>H∆∞·ªõng d·∫´n chƒÉm s√≥c: </h5>
            <p>{{result.careInstructions}}</p>
          </div>
          
          <div class="result-images" *ngIf="result.imageUrl">
            <h5>H√¨nh ·∫£nh tham kh·∫£o: </h5>
            <div class="image-gallery">
              <img 
                [src]="result.imageUrl" 
                [alt]="result.scientificName"
                class="reference-image">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && results.length === 0 && shouldShowEmptyState()">
    <div class="empty-icon">üå±</div>
    <h3>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h3>
    <p *ngIf="activeTab === 'upload'">Th·ª≠ v·ªõi h√¨nh ·∫£nh kh√°c ho·∫∑c ƒë·∫£m b·∫£o h√¨nh ·∫£nh ch·ª©a c√¢y r√µ r√†ng</p>
    <p *ngIf="activeTab === 'search'">Th·ª≠ v·ªõi t·ª´ kh√≥a kh√°c ho·∫∑c ki·ªÉm tra ch√≠nh t·∫£</p>
  </div>
</div>
