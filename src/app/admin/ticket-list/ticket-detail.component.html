<div class="admin-ticket-detail-layout">
  <app-admin-top-navigator></app-admin-top-navigator>
  <div class="admin-ticket-detail-main">
    <app-admin-sidebar></app-admin-sidebar>
    <div class="admin-ticket-detail-content">
      <div class="admin-ticket-detail-container" *ngIf="ticket">
        <div class="detail-header">
          <button class="back-btn" (click)="goBack()">
            ‚Üê Quay l·∫°i danh s√°ch
          </button>
          <h2>Ticket #{{ ticket.id }} - {{ ticket.title }}</h2>
          <a [routerLink]="['/admin/tickets', ticket.id, 'response']" class="send-response-btn">
            üì§ G·ª≠i ph·∫£n h·ªìi
          </a>
        </div>

        <div class="message-bar-wrapper">
          <div *ngIf="errorMsg" class="error-bar message-bar">{{ errorMsg }}</div>
          <div *ngIf="successMsg" class="success-bar message-bar">{{ successMsg }}</div>
        </div>

        <div class="ticket-info-section">
          <div class="ticket-meta">
            <div class="meta-row">
              <div class="meta-item">
                <label>Tr·∫°ng th√°i:</label>
                <span class="status-badge" [ngClass]="getStatusClass(ticket.status)">
                  {{ getStatusText(ticket.status) }}
                </span>
              </div>
              <div class="meta-item">
                <label>ƒê·ªô ∆∞u ti√™n:</label>
                <span class="priority-badge" [ngClass]="getPriorityClass(ticket.priority)">
                  {{ getPriorityText(ticket.priority) }}
                </span>
              </div>
              <div class="meta-item">
                <label>Danh m·ª•c:</label>
                <span class="category-badge">{{ getCategoryText(ticket.category) }}</span>
              </div>
            </div>
            <div class="meta-row">
              <div class="meta-item">
                <label>Ng∆∞·ªùi t·∫°o:</label>
                <span>{{ ticket.createdBy }}</span>
              </div>
              <div class="meta-item">
                <label>Ng∆∞·ªùi ƒë∆∞·ª£c giao:</label>
                <span *ngIf="ticket.assignedTo; else unassigned" class="assigned-to">
                  {{ ticket.assignedTo }}
                </span>
                <ng-template #unassigned>
                  <span class="unassigned">Ch∆∞a giao</span>
                </ng-template>
              </div>
              <div class="meta-item">
                <label>Ng√†y t·∫°o:</label>
                <span>{{ ticket.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
            </div>
          </div>

          <div class="ticket-description">
            <h3>M√¥ t·∫£ v·∫•n ƒë·ªÅ</h3>
            <div class="description-content">
              <p>{{ ticket.description }}</p>
            </div>
          </div>

          <div class="ticket-attachments" *ngIf="ticket.attachments && ticket.attachments.length > 0">
            <h3>T·ªáp ƒë√≠nh k√®m</h3>
            <div class="attachments-list">
              <div class="attachment-item" *ngFor="let attachment of ticket.attachments">
                <span class="attachment-icon">üìé</span>
                <span>{{ attachment }}</span>
              </div>
            </div>
          </div>

          <div class="ticket-tags" *ngIf="ticket.tags && ticket.tags.length > 0">
            <h3>Tags</h3>
            <div class="tags-list">
              <span class="tag" *ngFor="let tag of ticket.tags">#{{ tag }}</span>
            </div>
          </div>
        </div>

        <div class="responses-section">
          <h3>L·ªãch s·ª≠ ph·∫£n h·ªìi ({{ ticket.responses.length }})</h3>
          
          <div class="responses-list">
            <div class="response-item" *ngFor="let response of ticket.responses" 
                 [ngClass]="{'admin-response': response.isAdminResponse, 'user-response': !response.isAdminResponse}">
              <div class="response-header">
                <span class="response-author">{{ response.createdBy }}</span>
                <span class="response-date">{{ response.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                <span class="response-type" *ngIf="response.isAdminResponse">Admin</span>
              </div>
              <div class="response-content">
                <p>{{ response.content }}</p>
              </div>
            </div>
          </div>

          <div class="add-response-section">
            <h4>Th√™m ph·∫£n h·ªìi</h4>
            <div class="response-form">
              <textarea 
                [(ngModel)]="newResponse"
                placeholder="Nh·∫≠p n·ªôi dung ph·∫£n h·ªìi..."
                class="response-textarea"
                rows="4"
              ></textarea>
              <div class="response-actions">
                <button class="send-btn" (click)="sendResponse()">
                  üì§ G·ª≠i ph·∫£n h·ªìi
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="ticket-actions">
          <h3>H√†nh ƒë·ªông</h3>
          <div class="action-buttons">
            <div class="action-group">
              <label>C·∫≠p nh·∫≠t tr·∫°ng th√°i:</label>
              <div class="status-buttons">
                <button 
                  class="status-btn" 
                  [ngClass]="{'active': ticket.status === 'open'}"
                  (click)="updateStatus('open')"
                >
                  M·ªü
                </button>
                <button 
                  class="status-btn" 
                  [ngClass]="{'active': ticket.status === 'in_progress'}"
                  (click)="updateStatus('in_progress')"
                >
                  ƒêang x·ª≠ l√Ω
                </button>
                <button 
                  class="status-btn" 
                  [ngClass]="{'active': ticket.status === 'resolved'}"
                  (click)="updateStatus('resolved')"
                >
                  ƒê√£ gi·∫£i quy·∫øt
                </button>
                <button 
                  class="status-btn" 
                  [ngClass]="{'active': ticket.status === 'closed'}"
                  (click)="updateStatus('closed')"
                >
                  ƒê√£ ƒë√≥ng
                </button>
              </div>
            </div>
            
            <div class="action-group">
              <label>Giao ticket:</label>
              <select class="assign-select" (change)="onAssignChange($event)">
                <option value="">Ch·ªçn ng∆∞·ªùi x·ª≠ l√Ω</option>
                <option value="admin1" [selected]="ticket.assignedTo === 'admin1'">Admin 1</option>
                <option value="admin2" [selected]="ticket.assignedTo === 'admin2'">Admin 2</option>
                <option value="admin3" [selected]="ticket.assignedTo === 'admin3'">Admin 3</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="loading" class="loading-bar">ƒêang t·∫£i...</div>
      <div *ngIf="errorMsg" class="error-bar">{{ errorMsg }}</div>
    </div>
  </div>
  <app-admin-footer></app-admin-footer>
</div> 