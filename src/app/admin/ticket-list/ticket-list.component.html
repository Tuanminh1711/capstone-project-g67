<div class="admin-ticket-list-layout">
  <app-admin-top-navigator></app-admin-top-navigator>
  <div class="admin-ticket-list-main">
    <app-admin-sidebar></app-admin-sidebar>
    <div class="admin-ticket-list-content">
      <div class="admin-ticket-list-container" *ngIf="tickets$ | async as tickets">
        <div class="list-header">
          <h2>Danh s√°ch Ticket</h2>
          <div class="header-actions">
            <div class="search-box">
              <input 
                type="text" 
                [(ngModel)]="searchText"
                (input)="onSearchInputChange()"
                placeholder="T√¨m ki·∫øm ticket..."
                class="search-input"
              >
              <span class="search-icon">üîç</span>
            </div>
            <button class="reload-btn" (click)="reloadTickets()" title="T·∫£i l·∫°i danh s√°ch">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                <path d="M4 10a6 6 0 1 1 6 6" stroke="#388e3c" stroke-width="2" fill="none"/>
                <path d="M4 10V6M4 10h4" stroke="#388e3c" stroke-width="2" fill="none"/>
              </svg>
              C·∫≠p nh·∫≠t
            </button>
          </div>
        </div>

        <div class="message-bar-wrapper">
          <div *ngIf="errorMsg" class="error-bar message-bar">{{ errorMsg }}</div>
          <div *ngIf="successMsg" class="success-bar message-bar">{{ successMsg }}</div>
        </div>

        <div class="ticket-stats">
          <div class="stat-item">
            <span class="stat-number">{{ totalElements }}</span>
            <span class="stat-label">T·ªïng c·ªông</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getOpenTicketsCount() }}</span>
            <span class="stat-label">ƒêang m·ªü</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getInProgressTicketsCount() }}</span>
            <span class="stat-label">ƒêang x·ª≠ l√Ω</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getResolvedTicketsCount() }}</span>
            <span class="stat-label">ƒê√£ gi·∫£i quy·∫øt</span>
          </div>
        </div>

        <div class="ticket-table-container">
          <table class="ticket-table">
            <thead>
              <tr>
                <th>
                  <button class="sort-btn" (click)="sortBy('id')">
                    ID
                    <span *ngIf="sortField === 'id'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>
                  <button class="sort-btn" (click)="sortBy('title')">
                    Ti√™u ƒë·ªÅ
                    <span *ngIf="sortField === 'title'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>
                  <button class="sort-btn" (click)="sortBy('status')">
                    Tr·∫°ng th√°i
                    <span *ngIf="sortField === 'status'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>
                  <button class="sort-btn" (click)="sortBy('priority')">
                    ƒê·ªô ∆∞u ti√™n
                    <span *ngIf="sortField === 'priority'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>
                  <button class="sort-btn" (click)="sortBy('category')">
                    Danh m·ª•c
                    <span *ngIf="sortField === 'category'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>
                  <button class="sort-btn" (click)="sortBy('createdBy')">
                    Ng∆∞·ªùi t·∫°o
                    <span *ngIf="sortField === 'createdBy'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>
                  <button class="sort-btn" (click)="sortBy('createdAt')">
                    Ng√†y t·∫°o
                    <span *ngIf="sortField === 'createdAt'" class="sort-icon">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </button>
                </th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ticket of tickets" class="ticket-row">
                <td class="ticket-id">#{{ ticket.id }}</td>
                <td class="ticket-title">
                  <a (click)="viewDetail(ticket)" class="title-link">
                    {{ ticket.title }}
                  </a>
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(ticket.status)">
                    {{ getStatusText(ticket.status) }}
                  </span>
                </td>
                <td>
                  <span class="priority-badge" [ngClass]="getPriorityClass(ticket.priority)">
                    {{ getPriorityText(ticket.priority) }}
                  </span>
                </td>
                <td>
                  <span class="category-badge">{{ getCategoryText(ticket.category) }}</span>
                </td>
                <td class="created-by">{{ ticket.createdBy }}</td>
                <td class="created-date">{{ ticket.createdAt | date:'dd/MM/yyyy' }}</td>
                <td class="action-buttons">
                  <button class="view-btn" (click)="viewDetail(ticket)" title="Xem chi ti·∫øt">
                    üëÅÔ∏è Xem
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination-container" *ngIf="totalPages > 1">
          <div class="pagination-info">
            Hi·ªÉn th·ªã {{ (pageNo * pageSize) + 1 }}-{{ getEndIndex() }} c·ªßa {{ totalElements }} ticket
          </div>
          <div class="pagination-controls">
            <button 
              class="pagination-btn" 
              [disabled]="pageNo === 0"
              (click)="prevPage()"
            >
              ‚Üê Tr∆∞·ªõc
            </button>
            <div class="page-numbers">
              <button 
                *ngFor="let page of getVisiblePages()" 
                class="page-btn"
                [ngClass]="{'active': page === pageNo + 1}"
                (click)="goToPage(page - 1)"
              >
                {{ page }}
              </button>
            </div>
            <button 
              class="pagination-btn" 
              [disabled]="pageNo >= totalPages - 1"
              (click)="nextPage()"
            >
              Sau ‚Üí
            </button>
          </div>
        </div>

        <div *ngIf="loading" class="loading-bar">ƒêang t·∫£i...</div>
        
        <div *ngIf="!loading && tickets.length === 0" class="empty-state">
          <p>Kh√¥ng c√≥ ticket n√†o.</p>
        </div>
      </div>
    </div>
  </div>
  <app-admin-footer></app-admin-footer>
</div> 