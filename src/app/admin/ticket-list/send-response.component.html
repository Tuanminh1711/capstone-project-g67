<div class="admin-send-response-layout">
  <app-admin-top-navigator></app-admin-top-navigator>
  <div class="admin-send-response-main">
    <app-admin-sidebar></app-admin-sidebar>
    <div class="admin-send-response-content">
      <div class="admin-send-response-container" *ngIf="ticket">
        <div class="response-header">
          <div class="header-navigation">
            <button class="back-btn" (click)="goBack()">
              ‚Üê Quay l·∫°i ticket
            </button>
            <button class="list-btn" (click)="goToList()">
              üìã Danh s√°ch
            </button>
          </div>
          <h2>G·ª≠i ph·∫£n h·ªìi - Ticket #{{ ticket.id }}</h2>
        </div>

        <div class="message-bar-wrapper">
          <div *ngIf="errorMsg" class="error-bar message-bar">{{ errorMsg }}</div>
          <div *ngIf="successMsg" class="success-bar message-bar">{{ successMsg }}</div>
        </div>

        <div class="ticket-summary">
          <h3>Th√¥ng tin ticket</h3>
          <div class="ticket-info-grid">
            <div class="info-item">
              <label>Ti√™u ƒë·ªÅ:</label>
              <span class="ticket-title">{{ ticket.title }}</span>
            </div>
            <div class="info-item">
              <label>Tr·∫°ng th√°i:</label>
              <span class="status-badge" [ngClass]="getStatusClass(ticket.status)">
                {{ getStatusText(ticket.status) }}
              </span>
            </div>
            <div class="info-item">
              <label>ƒê·ªô ∆∞u ti√™n:</label>
              <span class="priority-badge" [ngClass]="getPriorityClass(ticket.priority)">
                {{ getPriorityText(ticket.priority) }}
              </span>
            </div>
            <div class="info-item">
              <label>Danh m·ª•c:</label>
              <span class="category-badge">{{ getCategoryText(ticket.category) }}</span>
            </div>
            <div class="info-item">
              <label>Ng∆∞·ªùi t·∫°o:</label>
              <span>{{ ticket.createdBy }}</span>
            </div>
            <div class="info-item">
              <label>Ng√†y t·∫°o:</label>
              <span>{{ ticket.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>
        </div>

        <div class="response-form-section">
          <h3>N·ªôi dung ph·∫£n h·ªìi</h3>
          
          <div class="form-group">
            <label for="template-select">Ch·ªçn template (t√πy ch·ªçn):</label>
            <select 
              id="template-select"
              [(ngModel)]="selectedTemplate" 
              (change)="onTemplateChange()"
              class="template-select"
            >
              <option value="0">-- Ch·ªçn template --</option>
              <option *ngFor="let template of responseTemplates" [value]="template.id">
                {{ template.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="response-content">N·ªôi dung ph·∫£n h·ªìi: <span class="required">*</span></label>
            <textarea 
              id="response-content"
              [(ngModel)]="responseContent"
              placeholder="Nh·∫≠p n·ªôi dung ph·∫£n h·ªìi..."
              class="response-textarea"
              rows="8"
            ></textarea>
            <div class="char-count">
              {{ responseContent.length }} k√Ω t·ª±
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="response-type">Lo·∫°i ph·∫£n h·ªìi:</label>
              <select id="response-type" [(ngModel)]="responseType" class="form-select">
                <option value="public">C√¥ng khai (user c√≥ th·ªÉ th·∫•y)</option>
                <option value="internal">N·ªôi b·ªô (ch·ªâ admin th·∫•y)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="priority-select">ƒê·ªô ∆∞u ti√™n:</label>
              <select id="priority-select" [(ngModel)]="priority" class="form-select">
                <option value="low">Th·∫•p</option>
                <option value="medium">Trung b√¨nh</option>
                <option value="high">Cao</option>
                <option value="urgent">Kh·∫©n c·∫•p</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="file-upload">T·ªáp ƒë√≠nh k√®m:</label>
            <div class="file-upload-area">
              <input 
                type="file" 
                id="file-upload"
                (change)="onFileSelected($event)"
                multiple
                class="file-input"
                accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif"
              >
              <div class="upload-placeholder">
                <span class="upload-icon">üìé</span>
                <span>K√©o th·∫£ file v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</span>
                <small>H·ªó tr·ª£: PDF, DOC, TXT, JPG, PNG (t·ªëi ƒëa 5MB/file)</small>
              </div>
            </div>
          </div>

          <div class="attachments-list" *ngIf="attachments.length > 0">
            <h4>T·ªáp ƒë√£ ch·ªçn:</h4>
            <div class="attachment-item" *ngFor="let file of attachments; let i = index">
              <span class="file-icon">üìÑ</span>
              <div class="file-info">
                <span class="file-name">{{ file.name }}</span>
                <span class="file-size">{{ formatFileSize(file.size) }}</span>
              </div>
              <button class="remove-btn" (click)="removeAttachment(i)" title="X√≥a file">
                ‚úï
              </button>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <div class="action-buttons">
            <button 
              class="save-draft-btn" 
              (click)="saveAsDraft()"
              [disabled]="loading"
            >
              üíæ L∆∞u nh√°p
            </button>
            <button 
              class="send-btn" 
              (click)="sendResponse()"
              [disabled]="loading"
            >
              <span *ngIf="!loading">üì§ G·ª≠i ph·∫£n h·ªìi</span>
              <span *ngIf="loading">‚è≥ ƒêang g·ª≠i...</span>
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="loading && !ticket" class="loading-bar">ƒêang t·∫£i th√¥ng tin ticket...</div>
    </div>
  </div>
  <app-admin-footer></app-admin-footer>
</div> 