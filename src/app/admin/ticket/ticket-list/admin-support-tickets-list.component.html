<div class="admin-support-tickets-page">
  <h1>Quản lý phiếu hỗ trợ</h1>
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Đang tải danh sách phiếu hỗ trợ...</p>
  </div>
  <div *ngIf="!isLoading && tickets.length > 0" class="tickets-table-container">

    <table class="tickets-table">
      <thead>
        <tr>
          <th>STT</th>
          <th>Tiêu đề</th>
          <th>Mô tả</th>
          <th>Người gửi</th>
          <th>Trạng thái</th>
          <th>Ngày tạo</th>
          <th>Số phản hồi</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ticket of filteredTickets; let i = index" (click)="viewTicketDetail(ticket)">
          <td>{{ i + 1 + (page * 10) }}</td>
          <td>{{ ticket.title }}</td>
          <td>{{ ticket.description }}</td>
          <td>{{ ticket.userName }}</td>
          <td>
            <span class="status-label status-{{ ticket.status | lowercase }}">
              {{ ticket.status }}
            </span>
          </td>
          <td>{{ formatDate(ticket.createdAt) }}</td>
          <td>{{ ticket.responseCount }}</td>
          <td>
            <div class="action-buttons">
              <!-- Nút Nhận phiếu hỗ trợ - chỉ hiện khi chưa nhận -->
              <button *ngIf="ticket.status !== 'CLAIMED'" 
                      class="btn-action btn-claim"
                      (click)="openClaimDialog(ticket); $event.stopPropagation()"
                      title="Nhận phiếu hỗ trợ để xử lý">
                <i class="fas fa-hand-paper"></i>
                <span>Nhận phiếu hỗ trợ</span>
              </button>
              
              <!-- Nút Trả lại phiếu hỗ trợ - chỉ hiện khi đã nhận -->
              <button *ngIf="ticket.status === 'CLAIMED'" 
                      class="btn-action btn-release"
                      (click)="openReleaseDialog(ticket); $event.stopPropagation()"
                      title="Trả lại phiếu hỗ trợ cho admin khác xử lý">
                <i class="fas fa-undo-alt"></i>
                <span>Trả lại phiếu hỗ trợ</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="pagination" *ngIf="totalPages > 1">
      <button [disabled]="page === 0" (click)="onPageChange(page - 1)">&lt;</button>
      <span>Trang {{ page + 1 }} / {{ totalPages }}</span>
      <button [disabled]="page + 1 >= totalPages" (click)="onPageChange(page + 1)">&gt;</button>
    </div>
  </div>
  <div *ngIf="!isLoading && tickets.length === 0" class="empty-container">
    <h2>Không có phiếu hỗ trợ nào</h2>
    <p>Không có phiếu nào được gửi bởi người dùng.</p>
  </div>
</div>
