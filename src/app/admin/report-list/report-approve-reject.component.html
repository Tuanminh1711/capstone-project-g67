<div class="admin-report-approve-reject-layout">
  <app-admin-top-navigator></app-admin-top-navigator>
  <div class="admin-report-approve-reject-main">
    <app-admin-sidebar></app-admin-sidebar>
    <div class="admin-report-approve-reject-content">
      <div class="admin-report-approve-reject-container" *ngIf="reports$ | async as reports">
        <div class="approve-reject-header">
          <h2>Duy·ªát/T·ª´ ch·ªëi b√°o c√°o</h2>
          <button class="reload-btn" (click)="reloadReports()" title="T·∫£i l·∫°i danh s√°ch">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
              <path d="M4 10a6 6 0 1 1 6 6" stroke="#388e3c" stroke-width="2" fill="none"/>
              <path d="M4 10V6M4 10h4" stroke="#388e3c" stroke-width="2" fill="none"/>
            </svg>
            C·∫≠p nh·∫≠t
          </button>
        </div>

        <div class="message-bar-wrapper">
          <div *ngIf="errorMsg" class="error-bar message-bar">{{ errorMsg }}</div>
          <div *ngIf="successMsg" class="success-bar message-bar">{{ successMsg }}</div>
        </div>

        <div class="summary-bar">
          <div class="summary-item">
            <span class="summary-label">T·ªïng s·ªë b√°o c√°o:</span>
            <span class="summary-value">{{ reports.length }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">ƒê√£ ch·ªçn:</span>
            <span class="summary-value">{{ getSelectedCount() }}</span>
          </div>
          <div class="summary-item">
            <button 
              class="select-all-btn" 
              (click)="toggleSelectAll()"
              [class.selected]="isAllSelected()"
            >
              {{ isAllSelected() ? 'B·ªè ch·ªçn t·∫•t c·∫£' : 'Ch·ªçn t·∫•t c·∫£' }}
            </button>
          </div>
        </div>

        <div class="reports-table-container">
          <table class="reports-table">
            <thead>
              <tr>
                <th class="checkbox-header">
                  <input 
                    type="checkbox" 
                    [checked]="isAllSelected()"
                    (change)="toggleSelectAll()"
                  >
                </th>
                <th>ID</th>
                <th>Ti√™u ƒë·ªÅ</th>
                <th>Ng∆∞·ªùi b√°o c√°o</th>
                <th>Ng√†y t·∫°o</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
                <th>Ghi ch√∫</th>
                <th>Chi ti·∫øt</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let report of reports" [class.selected-row]="report.selected">
                <td class="checkbox-cell">
                  <input 
                    type="checkbox" 
                    [checked]="report.selected"
                    (change)="toggleSelect(report)"
                  >
                </td>
                <td>{{ report.id }}</td>
                <td>
                  <a (click)="viewDetail(report)" class="report-link">{{ report.title }}</a>
                </td>
                <td>{{ report.reporterName }}</td>
                <td>{{ report.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(report.status)">
                    {{ getStatusText(report.status) }}
                  </span>
                </td>
                <td>
                  <select 
                    class="action-dropdown" 
                    [value]="report.action || ''"
                    (change)="onActionChange(report, $event)"
                    [disabled]="!report.selected"
                  >
                    <option value="">Ch·ªçn h√†nh ƒë·ªông</option>
                    <option value="approve">Duy·ªát</option>
                    <option value="reject">T·ª´ ch·ªëi</option>
                    <option value="resolve">Gi·∫£i quy·∫øt</option>
                  </select>
                  <span 
                    *ngIf="report.action" 
                    class="action-badge" 
                    [ngClass]="getActionClass(report.action)"
                  >
                    {{ getActionText(report.action) }}
                  </span>
                </td>
                <td>
                  <textarea 
                    class="notes-textarea" 
                    placeholder="Ghi ch√∫ (t√πy ch·ªçn)"
                    [value]="report.notes || ''"
                    (input)="updateNotes(report, $event)"
                    [disabled]="!report.selected"
                    rows="2"
                  ></textarea>
                </td>
                <td>
                  <button class="view-btn" (click)="viewDetail(report)" title="Xem chi ti·∫øt">
                    üëÅ Xem
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="action-bar" *ngIf="getSelectedCount() > 0">
          <div class="action-summary">
            <span>ƒê√£ ch·ªçn {{ getSelectedCount() }} b√°o c√°o</span>
            <span *ngIf="!canProcess()" class="warning-text">
              ‚ö†Ô∏è Vui l√≤ng ch·ªçn h√†nh ƒë·ªông cho t·∫•t c·∫£ b√°o c√°o ƒë√£ ch·ªçn
            </span>
          </div>
          <button 
            class="process-btn" 
            (click)="processReports()"
            [disabled]="!canProcess() || processing"
          >
            <span *ngIf="!processing">üöÄ X·ª≠ l√Ω b√°o c√°o</span>
            <span *ngIf="processing">‚è≥ ƒêang x·ª≠ l√Ω...</span>
          </button>
        </div>

        <div *ngIf="loading" class="loading-bar">ƒêang t·∫£i...</div>
        
        <div *ngIf="!loading && reports.length === 0" class="empty-state">
          <p>Kh√¥ng c√≥ b√°o c√°o n√†o c·∫ßn x·ª≠ l√Ω.</p>
        </div>
      </div>
    </div>
  </div>
  <app-admin-footer></app-admin-footer>
</div> 