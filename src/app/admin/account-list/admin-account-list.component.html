<app-admin-layout>
  <div class="admin-account-list-container" *ngIf="accounts$ | async as accounts">
    <div class="account-list-header">
      <h2>Danh s√°ch t√†i kho·∫£n</h2>
      <button class="reload-btn" (click)="reloadAccounts()" title="T·∫£i l·∫°i danh s√°ch">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
          <path d="M4 10a6 6 0 1 1 6 6" stroke="#388e3c" stroke-width="2" fill="none"/>
          <path d="M4 10V6M4 10h4" stroke="#388e3c" stroke-width="2" fill="none"/>
        </svg>
        C·∫≠p nh·∫≠t
      </button>
    </div>
    <div class="message-bar-wrapper">
      <div *ngIf="errorMsg" class="error-bar message-bar">{{ errorMsg }}</div>
      <div *ngIf="successMsg" class="success-bar message-bar">{{ successMsg }}</div>
    </div>
    <table class="account-table">
      <thead>
        <tr>
          <th (click)="sortBy('username')">T√™n ƒëƒÉng nh·∫≠p</th>
          <th (click)="sortBy('fullName')">H·ªç t√™n</th>
          <th (click)="sortBy('email')">Email</th>
          <th (click)="sortBy('phone')">ƒêi·ªán tho·∫°i</th>
          <th (click)="sortBy('role')">Vai tr√≤</th>
          <th (click)="sortBy('status')">Tr·∫°ng th√°i</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let acc of accounts">
          <td>
            <a (click)="viewDetail(acc)" class="account-link">{{ acc.username }}</a>
          </td>
          <td>
            <a (click)="viewDetail(acc)" class="account-link">{{ acc.fullName }}</a>
          </td>
          <td>{{ acc.email }}</td>
          <td>{{ acc.phone }}</td>
          <td>{{ acc.role | titlecase }}</td>
          <td colspan="2">
            <select class="status-dropdown" [ngClass]="{
              'active': acc.status.toLowerCase() === 'active',
              'inactive': acc.status.toLowerCase() === 'inactive',
              'banned': acc.status.toLowerCase() === 'banned'
            }" [value]="acc.status.toUpperCase()" (change)="changeStatus(acc, $event)">
              <option value="ACTIVE">Ho·∫°t ƒë·ªông</option>
              <option value="INACTIVE">ƒê√£ kh√≥a</option>
              <option value="BANNED">C·∫•m</option>
            </select>
            <button class="delete-btn" (click)="deleteAccount(acc)" title="X√≥a t√†i kho·∫£n">
              üóë X√≥a
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="pagination-bar" *ngIf="accounts.length > 0">
      <button (click)="prevPage()" [disabled]="pageNo === 0">&lt; Tr∆∞·ªõc</button>
      <span>Trang {{ pageNo + 1 }} / {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="pageNo + 1 >= totalPages">Sau &gt;</button>
    </div>
    <div *ngIf="loading" class="loading-bar">ƒêang t·∫£i...</div>
  </div>
</app-admin-layout>
