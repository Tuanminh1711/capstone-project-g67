
<div class="admin-plant-list-container">
  <!-- Header and create button removed -->
  <div class="search-bar-container">
    <div class="search-bar">
      <input 
        type="text" 
        [(ngModel)]="searchText" 
        (input)="onSearchInputChange()" 
        placeholder="Tìm kiếm cây..." 
        class="search-input"
      />
      <button 
        type="button" 
        (click)="onSearch()" 
        class="search-btn"
      >
        <i class="fas fa-search"></i>
        Tìm kiếm
      </button>
    </div>
  </div>
  <div *ngIf="errorMsg" class="error-bar">
    {{ errorMsg }}
    <button class="retry-btn" (click)="fetchPlants(pageNo, currentKeyword)">
      <i class="fas fa-redo"></i>
      Thử lại
    </button>
  </div>
  <div *ngIf="loading" class="loading-bar">
    <i class="fas fa-spinner fa-spin"></i>
    Đang tải dữ liệu...
  </div>
  <div class="table-wrapper" *ngIf="!loading || (plants$ | async)?.length">
    <table class="plant-table">
      <thead>
        <tr>
          <th class="sortable-header" (click)="onSort('id')" [class.active]="sortField === 'id'">
            ID <i [class]="getSortIcon('id')"></i>
          </th>
          <th class="sortable-header" (click)="onSort('commonName')" [class.active]="sortField === 'commonName'">
            Tên thường gọi <i [class]="getSortIcon('commonName')"></i>
          </th>
          <th class="sortable-header" (click)="onSort('categoryName')" [class.active]="sortField === 'categoryName'">
            Danh mục <i [class]="getSortIcon('categoryName')"></i>
          </th>
          <th>Khóa</th>
          <th class="sortable-header" (click)="onSort('createdAt')" [class.active]="sortField === 'createdAt'">
            Ngày tạo <i [class]="getSortIcon('createdAt')"></i>
          </th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let plant of plants$ | async; trackBy: trackByPlant">
          <td>{{ plant.id }}</td>
          <td>{{ plant.commonName }}</td>
          <td>{{ plant.categoryName || '-' }}</td>
          <td>
            <button 
              (click)="lockUnlockPlant(plant)" 
              [class]="getLockButtonClass(plant)"
              class="lock-btn"
              [disabled]="plant.isUpdating"
            >
              <i [class]="getLockIcon(plant)"></i>
              {{ getLockButtonText(plant) }}
            </button>
          </td>
          <td>{{ formatDate(plant.createdAt) || '-' }}</td>
          <td>
            <button (click)="viewPlantDetail(plant)" class="detail-btn">Chi tiết</button>
            <!-- <button (click)="deletePlant(plant)" class="delete-btn">Xóa</button> -->
          </td>
        </tr>
        <tr *ngIf="!(plants$ | async)?.length && !loading">
          <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
            Không có dữ liệu cây trồng.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pagination-bar" *ngIf="totalPages > 1">
    <button class="pagination-btn" (click)="goToPage(pageNo-1)" [disabled]="pageNo === 0">
      <i class="fas fa-chevron-left"></i>
    </button>
    <span class="pagination-index">{{ pageNo + 1 }} / {{ totalPages }}</span>
    <button class="pagination-btn" (click)="goToPage(pageNo+1)" [disabled]="pageNo + 1 >= totalPages">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>
