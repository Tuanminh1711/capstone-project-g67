<!-- Giao diện chuyên nghiệp, tối giản, không lạm dụng icon -->
<div class="update-plant-page">
  <div class="update-plant-header">
    <h1>Chỉnh sửa thông tin cây cảnh</h1>
    <p class="subtitle">Cập nhật chi tiết, hình ảnh và thông tin chăm sóc</p>
  </div>

  <div *ngIf="loading" class="loading-section">
    <div class="loading-card">
      <div class="loading-spinner-large"></div>
      <h3>Đang tải thông tin cây cảnh...</h3>
    </div>
  </div>

  <div *ngIf="errorMsg" class="alert error">{{ errorMsg }}</div>
  <div *ngIf="successMsg" class="alert success">{{ successMsg }}</div>
  <div *ngIf="validationErrors.length > 0" class="alert warning">
    <ul>
      <li *ngFor="let error of validationErrors">{{ error }}</li>
    </ul>
  </div>

  <div *ngIf="plant && !loading" class="update-plant-content">
    <div class="plant-image-block">
      <div *ngIf="plant.imageUrls && plant.imageUrls.length > 0" class="plant-image-gallery">
        <div *ngFor="let url of plant.imageUrls; let i = index" class="image-item">
          <img [src]="getPlantImageUrl(url)" [alt]="plant.commonName" (error)="onImageError($event)" style="cursor:pointer; border:2px dashed #aaa; border-radius:8px;" (click)="fileInput.click()" title="Click để chọn ảnh mới" />
            <div class="image-actions">
              <!-- Ảnh chính đã bị ẩn theo yêu cầu -->
            <!--
    <div class="image-update-note">
      <i class="fas fa-info-circle"></i>
      <span>
        <b>Lưu ý:</b> Để cập nhật ảnh cho cây, hãy chọn và tải lên ảnh mới. Ảnh mới sẽ được thêm vào danh sách ảnh của cây. Nếu không thấy ảnh mới trong database, hãy kiểm tra lại API backend hoặc thử tải lại trang.
      </span>
    </div>
            -->
          </div>
        </div>
      </div>
      <div *ngIf="!plant.imageUrls || plant.imageUrls.length === 0" class="no-image">
        <i class="fas fa-seedling"></i>
        <span>Chưa có ảnh</span>
      </div>
      <div class="upload-section">
        <input #fileInput type="file" multiple (change)="onImageFilesSelected($event)" accept="image/*" hidden />
        <ng-container *ngIf="selectedFiles && selectedFiles.length > 0">
          <div class="demo-preview-list" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-bottom:10px;">
            <img *ngFor="let url of previewUrls; let i = index" [src]="url" [alt]="'demo-' + i" style="width:80px; height:80px; object-fit:cover; border:1.5px solid #aaa; border-radius:6px; background:#f8f8f8;" />
          </div>
          <button type="button" class="main-upload-btn main-action-btn" (click)="uploadSelectedImages()" style="background:#28a745; color:#fff; font-weight:bold; border-radius:6px; padding:8px 18px; margin-top:10px; width:100%; max-width:320px; display:block; margin-left:auto; margin-right:auto;">
            <i class="fas fa-save"></i> Lưu thay đổi
          </button>
          <span class="selected-files-info" style="display:block; text-align:center; margin-top:4px; color:#007bff;">
            Đã chọn {{selectedFiles.length}} ảnh
          </span>
        </ng-container>
      </div>
    </div>
    <form (ngSubmit)="onSubmit()" #plantForm="ngForm" class="plant-form-block">
      <div class="form-row">
        <div class="form-group">
          <label for="commonName">Tên thường gọi *</label>
        <input id="commonName" type="text" [(ngModel)]="updateForm.commonName" name="commonName" required #commonName="ngModel" (ngModelChange)="onFieldChange()" />
        </div>
        <div class="form-group">
          <label for="scientificName">Tên khoa học *</label>
        <input id="scientificName" type="text" [(ngModel)]="updateForm.scientificName" name="scientificName" required #scientificName="ngModel" (ngModelChange)="onFieldChange()" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="categoryId">ID Danh mục *</label>
        <input id="categoryId" type="number" [(ngModel)]="updateForm.categoryId" name="categoryId" required min="1" (ngModelChange)="onFieldChange()" />
        </div>
        <div class="form-group">
          <label for="status">Trạng thái *</label>
        <select id="status" [(ngModel)]="updateForm.status" name="status" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of statusOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="lightRequirement">Yêu cầu ánh sáng *</label>
        <select id="lightRequirement" [(ngModel)]="updateForm.lightRequirement" name="lightRequirement" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of lightRequirementOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="waterRequirement">Yêu cầu nước *</label>
        <select id="waterRequirement" [(ngModel)]="updateForm.waterRequirement" name="waterRequirement" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of waterRequirementOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="careDifficulty">Độ khó chăm sóc *</label>
        <select id="careDifficulty" [(ngModel)]="updateForm.careDifficulty" name="careDifficulty" required (ngModelChange)="onFieldChange()">
            <option *ngFor="let option of careDifficultyOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="suitableLocation">Vị trí phù hợp</label>
        <input id="suitableLocation" type="text" [(ngModel)]="updateForm.suitableLocation" name="suitableLocation" (ngModelChange)="onFieldChange()" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="description">Mô tả về cây</label>
        <textarea id="description" [(ngModel)]="updateForm.description" name="description" rows="3" (ngModelChange)="onFieldChange()"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="careInstructions">Hướng dẫn chăm sóc</label>
        <textarea id="careInstructions" [(ngModel)]="updateForm.careInstructions" name="careInstructions" rows="3" (ngModelChange)="onFieldChange()"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group full-width">
          <label for="commonDiseases">Bệnh thường gặp</label>
        <input id="commonDiseases" type="text" [(ngModel)]="updateForm.commonDiseases" name="commonDiseases" (ngModelChange)="onFieldChange()" />
        </div>
      </div>
      <div class="form-actions">
        <button type="button" (click)="resetForm()" [disabled]="isUpdating" class="btn ghost">Đặt lại</button>
        <button type="button" (click)="onCancel()" [disabled]="isUpdating" class="btn secondary">Hủy bỏ</button>
        <button type="submit" [disabled]="!plantForm.valid || isUpdating" class="btn primary">
          {{ isUpdating ? 'Đang cập nhật...' : 'Lưu thông tin' }}
        </button>
      </div>
    </form>
  </div>
</div>
