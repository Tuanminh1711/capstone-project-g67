<div class="admin-report-list-container" *ngIf="reports$ | async as reports">
  
  <div class="message-bar-wrapper">
    <div *ngIf="errorMsg" class="error-bar message-bar">{{ errorMsg }}</div>
    <div *ngIf="successMsg" class="success-bar message-bar">{{ successMsg }}</div>
  </div>

  <div class="search-bar" style="position: relative;">
    <input 
      type="text" 
      [(ngModel)]="searchText" 
      (input)="onSearchInputChange()"
      placeholder="Tìm kiếm báo cáo..."
      class="search-input"
      style="padding-right: 38px;"
    >
    <span class="search-icon" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #888; pointer-events: none;">
      <i class="fas fa-search"></i>
    </span>
  </div>

  <table class="report-table">
    <thead>
      <tr>
        <th>STT</th>
        <th (click)="sortBy('title')">Tiêu đề</th>
        <th (click)="sortBy('reporterName')">Người báo cáo</th>
        <th (click)="sortBy('createdAt')">Ngày tạo</th>
        <th (click)="sortBy('status')">Trạng thái</th>
        <th>Hành động</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let report of reports; let i = index" (click)="viewDetail(report)" class="clickable-row">
        <td>{{ i + 1 + (pageNo * 10) }}</td>
        <td>
          <span class="report-title">{{ report.reason }}</span>
        </td>
        <td>{{ report.reporterName }}</td>
        <td>{{ report.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
        <td>
          <span class="status-badge status-inline" [ngClass]="getStatusClass(report.status)">
            {{ getStatusText(report.status) }}
          </span>
        </td>
        <td>
          <div class="action-buttons" (click)="$event.stopPropagation()">
            <button class="claim-btn"
                    [disabled]="['CLAIMED','APPROVED','REJECTED'].includes(report.status)"
                    *ngIf="getStatusText(report.status)"
                    (click)="claimReport(report.reportId)"
                    title="Nhận xử lý báo cáo">
              <i class="fas fa-user-check"></i>
              Nhận xử lý
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination-bar" style="justify-content: flex-end;" *ngIf="reports.length > 0">
    <button class="pagination-btn" (click)="prevPage()" [disabled]="pageNo === 0">
      <i class="fas fa-chevron-left"></i>
    </button>
    <span class="pagination-index">{{ pageNo + 1 }} / {{ totalPages }}</span>
    <button class="pagination-btn" (click)="nextPage()" [disabled]="pageNo + 1 >= totalPages">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <div *ngIf="loading" class="loading-bar">Đang tải...</div>
  
  <div *ngIf="!loading && reports.length === 0" class="empty-state">
    <p>Không có báo cáo nào.</p>
  </div>
</div>