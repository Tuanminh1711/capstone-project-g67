<app-top-navigator></app-top-navigator>

<div class="chat-container">
  <div class="chat-wrapper">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="header-info">
        <div class="chat-title">
          <span class="title-icon">üí¨</span>
          <h3>Ph√≤ng Chat VIP Community</h3>
        </div>
        <div class="online-status">
          <span class="status-dot"></span>
          <span class="status-text">ƒêang ho·∫°t ƒë·ªông</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="action-btn" disabled title="Cu·ªôc g·ªçi tho·∫°i">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
          </svg>
        </button>
        <button class="action-btn" disabled title="Cu·ªôc g·ªçi video">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
          </svg>
        </button>
        <button class="action-btn" disabled title="Th√¥ng tin nh√≥m">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages" #messagesContainer>
      <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i tin nh·∫Øn...</p>
      </div>

      <div *ngIf="error && !loading" class="error-state">
        <div class="error-icon">‚ö†Ô∏è</div>
        <p>{{ error }}</p>
        <button class="retry-btn" (click)="fetchHistory()">Th·ª≠ l·∫°i</button>
      </div>

      <div *ngIf="!loading && messages.length === 0" class="empty-state">
        <div class="empty-icon">üí≠</div>
        <h4>Ch∆∞a c√≥ tin nh·∫Øn n√†o</h4>
        <p>H√£y b·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán ƒë·∫ßu ti√™n!</p>
      </div>

      <div *ngIf="!loading && messages.length > 0" class="messages-list">
        <div *ngFor="let msg of messages; trackBy: trackMessage" 
             class="message-wrapper"
             [class.own-message]="isOwnMessage(msg)"
             [class.other-message]="!isOwnMessage(msg)">
          
          <!-- Tin nh·∫Øn c·ªßa ng∆∞·ªùi kh√°c (b√™n tr√°i) -->
          <div class="message-bubble" *ngIf="!isOwnMessage(msg)">
            <div class="message-header">
              <div class="sender-avatar">
                <img [src]="getAvatarUrl(msg)" [alt]="msg.senderRole || 'User'" />
              </div>
              <div class="sender-info">
                <span class="sender-name">{{ msg.senderRole || 'User' }}</span>
                <div class="role-badge" [class]="getRoleBadgeClass(msg.senderRole)">
                  {{ getRoleDisplayName(msg.senderRole) }}
                </div>
              </div>
            </div>
            
            <div class="message-content">
              {{ msg.content }}
            </div>
            
            <div class="message-footer">
              <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
            </div>
          </div>

          <!-- Tin nh·∫Øn c·ªßa m√¨nh (b√™n ph·∫£i) -->
          <div class="message-bubble own-bubble" *ngIf="isOwnMessage(msg)">
            <div class="message-header own-header">
              <div class="own-sender-info">
                <span class="own-sender-name">B·∫°n</span>
                <div class="role-badge vip-badge">VIP</div>
              </div>
            </div>
            
            <div class="message-content">
              {{ msg.content }}
            </div>
            
            <div class="message-footer">
              <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
              <div class="message-status">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input-container">
      <form class="chat-input-form" (ngSubmit)="sendMessage()" *ngIf="!loading">
        <div class="input-actions">
          <button type="button" class="input-action-btn" disabled title="ƒê√≠nh k√®m h√¨nh ·∫£nh">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
            </svg>
          </button>
          
          <button type="button" class="input-action-btn" disabled title="ƒê√≠nh k√®m file">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
            </svg>
          </button>
        </div>

        <div class="input-wrapper">
          <input 
            [(ngModel)]="newMessage" 
            name="newMessage"
            placeholder="Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n..."
            autocomplete="off"
            class="message-input"
            (keydown.enter)="sendMessage(); $event.preventDefault()"
          />
          
          <button 
            type="submit" 
            class="send-button"
            [disabled]="!newMessage.trim()"
            [class.active]="newMessage.trim()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
